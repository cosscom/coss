{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "toast",
  "type": "registry:ui",
  "dependencies": [
    "@base-ui/react"
  ],
  "registryDependencies": [
    "@coss/button"
  ],
  "files": [
    {
      "path": "registry/default/ui/toast.tsx",
      "content": "\"use client\";\n\nimport {\n  Toast,\n  type ToastManager,\n  type ToastManagerAddOptions,\n  type ToastManagerEvent,\n  type ToastManagerPromiseOptions,\n} from \"@base-ui/react/toast\";\nimport {\n  CircleAlertIcon,\n  CircleCheckIcon,\n  InfoIcon,\n  LoaderCircleIcon,\n  TriangleAlertIcon,\n} from \"lucide-react\";\nimport { useEffect, useRef } from \"react\";\n\nimport { cn } from \"@/registry/default/lib/utils\";\nimport { buttonVariants } from \"@/registry/default/ui/button\";\n\ntype RepeatEffect = \"bounce\" | \"shake\";\n\ninterface ToastData {\n  tooltipStyle?: boolean;\n  showClose?: boolean;\n  repeatCount?: number;\n  repeatEffect?: RepeatEffect;\n}\n\ninterface ToastAddOptions extends ToastManagerAddOptions<ToastData> {\n  dedupe?: boolean;\n  dedupeKey?: string;\n  repeatEffect?: RepeatEffect;\n}\n\nconst DEFAULT_EFFECTS: Record<string, RepeatEffect> = {\n  error: \"shake\",\n  info: \"bounce\",\n  success: \"bounce\",\n  warning: \"bounce\",\n};\n\nfunction getDefaultEffect(type?: string): RepeatEffect {\n  return (type && DEFAULT_EFFECTS[type]) || \"bounce\";\n}\n\nfunction buildFingerprint(\n  type: string | undefined,\n  title: unknown,\n  description: unknown,\n): string | null {\n  if (typeof title !== \"string\") return null;\n  if (description !== undefined && typeof description !== \"string\") return null;\n  return `${type ?? \"\"}::${title}::${description ?? \"\"}`;\n}\n\nfunction resolvePromiseOptions<T, Data extends object>(\n  options:\n    | string\n    | ToastManagerAddOptions<Data>\n    | ((result: T) => string | ToastManagerAddOptions<Data>),\n  result?: T,\n): ToastManagerAddOptions<Data> {\n  if (typeof options === \"string\") return { description: options };\n  if (typeof options === \"function\") {\n    const resolved = options(result as T);\n    return typeof resolved === \"string\" ? { description: resolved } : resolved;\n  }\n  return options;\n}\n\nfunction createDedupedToastManager(): {\n  add: (options: ToastAddOptions) => string;\n  close: (id: string) => void;\n  update: ToastManager[\"update\"];\n  promise: ToastManager[\"promise\"];\n  provider: ToastManager;\n} {\n  const baseManager: ToastManager = Toast.createToastManager();\n\n  const activeMap = new Map<string, string>();\n  const toastOrder: string[] = [];\n  const toastDataById = new Map<string, ToastData>();\n\n  function registerToastOrder(id: string) {\n    const idx = toastOrder.indexOf(id);\n    if (idx !== -1) toastOrder.splice(idx, 1);\n    toastOrder.unshift(id);\n  }\n\n  function unregisterToastOrder(id: string) {\n    const idx = toastOrder.indexOf(id);\n    if (idx !== -1) toastOrder.splice(idx, 1);\n  }\n\n  function isFrontmostToast(id: string): boolean {\n    return toastOrder[0] === id;\n  }\n\n  baseManager[\" subscribe\"]((event: ToastManagerEvent) => {\n    const id = event.options?.id;\n    if (!id) return;\n    if (event.action === \"add\") registerToastOrder(id);\n    if (event.action === \"close\") unregisterToastOrder(id);\n  });\n\n  function cleanupActiveMap(id: string) {\n    for (const [key, toastId] of activeMap) {\n      if (toastId === id) {\n        activeMap.delete(key);\n        break;\n      }\n    }\n  }\n\n  function addTracked(\n    key: string,\n    rest: Omit<ToastAddOptions, \"dedupe\" | \"dedupeKey\" | \"repeatEffect\">,\n  ): string {\n    const originalOnRemove = rest.onRemove;\n    const id = baseManager.add({\n      ...rest,\n      onRemove() {\n        cleanupActiveMap(id);\n        toastDataById.delete(id);\n        originalOnRemove?.();\n      },\n    });\n    toastDataById.set(id, rest.data ? { ...rest.data } : {});\n    activeMap.set(key, id);\n    return id;\n  }\n\n  function resolveDedupeKey(options: ToastAddOptions): string | null {\n    if (options.dedupe === false) return null;\n    if (options.dedupeKey) return options.dedupeKey;\n    return buildFingerprint(options.type, options.title, options.description);\n  }\n\n  function add(options: ToastAddOptions): string {\n    const {\n      dedupe: _dedupe,\n      dedupeKey: _dedupeKey,\n      repeatEffect,\n      ...rest\n    } = options;\n    const key = resolveDedupeKey(options);\n\n    if (key === null) {\n      return baseManager.add(rest);\n    }\n\n    const existingId = activeMap.get(key);\n\n    if (!existingId) {\n      return addTracked(key, rest);\n    }\n\n    if (!toastOrder.includes(existingId)) {\n      cleanupActiveMap(existingId);\n      toastDataById.delete(existingId);\n      return addTracked(key, rest);\n    }\n\n    if (isFrontmostToast(existingId)) {\n      const effect = repeatEffect ?? getDefaultEffect(rest.type);\n      const previousData = toastDataById.get(existingId) ?? {};\n      const previousRepeatCount =\n        typeof previousData.repeatCount === \"number\"\n          ? previousData.repeatCount\n          : 0;\n      const mergedData: ToastData = {\n        ...previousData,\n        ...(rest.data ?? {}),\n        repeatCount: previousRepeatCount + 1,\n        repeatEffect: effect,\n      };\n\n      baseManager.update(existingId, {\n        data: mergedData,\n        timeout: rest.timeout,\n      });\n      toastDataById.set(existingId, mergedData);\n      return existingId;\n    }\n\n    cleanupActiveMap(existingId);\n    unregisterToastOrder(existingId);\n    toastDataById.delete(existingId);\n    baseManager.close(existingId);\n    return addTracked(key, rest);\n  }\n\n  function promise<Value, Data extends ToastData = ToastData>(\n    promiseValue: Promise<Value>,\n    options: ToastManagerPromiseOptions<Value, Data>,\n  ): Promise<Value> {\n    const loadingOptions = resolvePromiseOptions<never, Data>(options.loading);\n    const id = baseManager.add({\n      ...loadingOptions,\n      type: \"loading\",\n    });\n    const handledPromise = promiseValue\n      .then((result) => {\n        const successOptions = resolvePromiseOptions<Value, Data>(\n          options.success,\n          result,\n        );\n        baseManager.update(id, {\n          ...successOptions,\n          timeout: (successOptions as { timeout?: number }).timeout,\n          type: \"success\",\n        });\n        return result;\n      })\n      .catch((error: unknown) => {\n        const errorOptions = resolvePromiseOptions<unknown, Data>(\n          options.error,\n          error,\n        );\n        baseManager.update(id, {\n          ...errorOptions,\n          timeout: (errorOptions as { timeout?: number }).timeout,\n          type: \"error\",\n        });\n        return Promise.reject(error);\n      });\n    return handledPromise;\n  }\n\n  return {\n    add,\n    close: (id: string) => baseManager.close(id),\n    promise,\n    provider: baseManager,\n    update: baseManager.update.bind(baseManager),\n  };\n}\n\nconst toastManager = createDedupedToastManager();\nconst anchoredToastManager = createDedupedToastManager();\n\nfunction useRepeatEffect(toast: { data?: ToastData }) {\n  const ref = useRef<HTMLDivElement>(null);\n  const prevRepeatCountRef = useRef(toast.data?.repeatCount);\n\n  useEffect(() => {\n    const repeatCount = toast.data?.repeatCount;\n    const effect = toast.data?.repeatEffect;\n    if (repeatCount === undefined || repeatCount === prevRepeatCountRef.current)\n      return;\n    prevRepeatCountRef.current = repeatCount;\n\n    const el = ref.current;\n    if (!el || !effect) return;\n\n    el.removeAttribute(\"data-repeat-effect\");\n    const raf = requestAnimationFrame(() => {\n      el.setAttribute(\"data-repeat-effect\", effect);\n    });\n    return () => cancelAnimationFrame(raf);\n  }, [toast.data?.repeatCount, toast.data?.repeatEffect]);\n\n  useEffect(() => {\n    const el = ref.current;\n    if (!el) return;\n    const cleanup = () => el.removeAttribute(\"data-repeat-effect\");\n    el.addEventListener(\"animationend\", cleanup);\n    return () => el.removeEventListener(\"animationend\", cleanup);\n  }, []);\n\n  return ref;\n}\n\nconst TOAST_ICONS = {\n  error: CircleAlertIcon,\n  info: InfoIcon,\n  loading: LoaderCircleIcon,\n  success: CircleCheckIcon,\n  warning: TriangleAlertIcon,\n} as const;\n\ntype ToastPosition =\n  | \"top-left\"\n  | \"top-center\"\n  | \"top-right\"\n  | \"bottom-left\"\n  | \"bottom-center\"\n  | \"bottom-right\";\n\ninterface ToastProviderProps extends Toast.Provider.Props {\n  position?: ToastPosition;\n}\n\nfunction ToastProvider({\n  children,\n  position = \"bottom-right\",\n  ...props\n}: ToastProviderProps) {\n  return (\n    <Toast.Provider toastManager={toastManager.provider} {...props}>\n      {children}\n      <Toasts position={position} />\n    </Toast.Provider>\n  );\n}\n\nfunction StackedToastItem({\n  toast,\n  position,\n  isTop,\n}: {\n  toast: Parameters<typeof Toast.Root>[0][\"toast\"];\n  position: ToastPosition;\n  isTop: boolean;\n}) {\n  const effectRef = useRepeatEffect(toast);\n  const Icon = toast.type\n    ? TOAST_ICONS[toast.type as keyof typeof TOAST_ICONS]\n    : null;\n\n  return (\n    <Toast.Root\n      className={cn(\n        \"absolute z-[calc(9999-var(--toast-index))] h-(--toast-calc-height) w-full select-none rounded-lg border bg-popover not-dark:bg-clip-padding text-popover-foreground shadow-lg/5 [transition:transform_.5s_cubic-bezier(.22,1,.36,1),opacity_.5s,height_.15s] before:pointer-events-none before:absolute before:inset-0 before:rounded-[calc(var(--radius-lg)-1px)] before:shadow-[0_1px_--theme(--color-black/4%)] dark:before:shadow-[0_-1px_--theme(--color-white/6%)]\",\n        // Base positioning using data-position\n        \"data-[position*=right]:right-0 data-[position*=right]:left-auto\",\n        \"data-[position*=left]:right-auto data-[position*=left]:left-0\",\n        \"data-[position*=center]:right-0 data-[position*=center]:left-0\",\n        \"data-[position*=top]:top-0 data-[position*=top]:bottom-auto data-[position*=top]:origin-top\",\n        \"data-[position*=bottom]:top-auto data-[position*=bottom]:bottom-0 data-[position*=bottom]:origin-bottom\",\n        // Gap fill for hover\n        \"after:absolute after:left-0 after:h-[calc(var(--toast-gap)+1px)] after:w-full\",\n        \"data-[position*=top]:after:top-full\",\n        \"data-[position*=bottom]:after:bottom-full\",\n        // Define some variables\n        \"[--toast-calc-height:var(--toast-frontmost-height,var(--toast-height))] [--toast-gap:--spacing(3)] [--toast-peek:--spacing(3)] [--toast-scale:calc(max(0,1-(var(--toast-index)*.1)))] [--toast-shrink:calc(1-var(--toast-scale))]\",\n        // Define offset-y variable\n        \"data-[position*=top]:[--toast-calc-offset-y:calc(var(--toast-offset-y)+var(--toast-index)*var(--toast-gap)+var(--toast-swipe-movement-y))]\",\n        \"data-[position*=bottom]:[--toast-calc-offset-y:calc(var(--toast-offset-y)*-1+var(--toast-index)*var(--toast-gap)*-1+var(--toast-swipe-movement-y))]\",\n        // Default state transform\n        \"data-[position*=top]:transform-[translateX(var(--toast-swipe-movement-x))_translateY(calc(var(--toast-swipe-movement-y)+(var(--toast-index)*var(--toast-peek))+(var(--toast-shrink)*var(--toast-calc-height))))_scale(var(--toast-scale))]\",\n        \"data-[position*=bottom]:transform-[translateX(var(--toast-swipe-movement-x))_translateY(calc(var(--toast-swipe-movement-y)-(var(--toast-index)*var(--toast-peek))-(var(--toast-shrink)*var(--toast-calc-height))))_scale(var(--toast-scale))]\",\n        // Limited state\n        \"data-limited:opacity-0\",\n        // Expanded state\n        \"data-expanded:h-(--toast-height)\",\n        \"data-position:data-expanded:transform-[translateX(var(--toast-swipe-movement-x))_translateY(var(--toast-calc-offset-y))]\",\n        // Starting and ending animations\n        \"data-[position*=top]:data-starting-style:transform-[translateY(calc(-100%-var(--toast-inset)))]\",\n        \"data-[position*=bottom]:data-starting-style:transform-[translateY(calc(100%+var(--toast-inset)))]\",\n        \"data-ending-style:opacity-0\",\n        // Ending animations (direction-aware, position-aware for default)\n        \"data-[position*=top]:data-ending-style:not-data-limited:not-data-swipe-direction:transform-[translateY(calc(-100%-var(--toast-inset)))]\",\n        \"data-[position*=bottom]:data-ending-style:not-data-limited:not-data-swipe-direction:transform-[translateY(calc(100%+var(--toast-inset)))]\",\n        \"data-ending-style:data-[swipe-direction=left]:transform-[translateX(calc(var(--toast-swipe-movement-x)-100%-var(--toast-inset)))_translateY(var(--toast-calc-offset-y))]\",\n        \"data-ending-style:data-[swipe-direction=right]:transform-[translateX(calc(var(--toast-swipe-movement-x)+100%+var(--toast-inset)))_translateY(var(--toast-calc-offset-y))]\",\n        \"data-ending-style:data-[swipe-direction=up]:transform-[translateY(calc(var(--toast-swipe-movement-y)-100%-var(--toast-inset)))]\",\n        \"data-ending-style:data-[swipe-direction=down]:transform-[translateY(calc(var(--toast-swipe-movement-y)+100%+var(--toast-inset)))]\",\n        // Ending animations (expanded)\n        \"data-expanded:data-ending-style:data-[swipe-direction=left]:transform-[translateX(calc(var(--toast-swipe-movement-x)-100%-var(--toast-inset)))_translateY(var(--toast-calc-offset-y))]\",\n        \"data-expanded:data-ending-style:data-[swipe-direction=right]:transform-[translateX(calc(var(--toast-swipe-movement-x)+100%+var(--toast-inset)))_translateY(var(--toast-calc-offset-y))]\",\n        \"data-expanded:data-ending-style:data-[swipe-direction=up]:transform-[translateY(calc(var(--toast-swipe-movement-y)-100%-var(--toast-inset)))]\",\n        \"data-expanded:data-ending-style:data-[swipe-direction=down]:transform-[translateY(calc(var(--toast-swipe-movement-y)+100%+var(--toast-inset)))]\",\n        // Repeat-effect animations (bounce/shake on dedup)\n        \"data-[repeat-effect=bounce]:animate-toast-bounce\",\n        \"data-[repeat-effect=shake]:animate-toast-shake\",\n      )}\n      data-position={position}\n      key={toast.id}\n      ref={effectRef}\n      swipeDirection={\n        position.includes(\"center\")\n          ? [isTop ? \"up\" : \"down\"]\n          : position.includes(\"left\")\n            ? [\"left\", isTop ? \"up\" : \"down\"]\n            : [\"right\", isTop ? \"up\" : \"down\"]\n      }\n      toast={toast}\n    >\n      <Toast.Content className=\"pointer-events-auto flex items-center justify-between gap-1.5 overflow-hidden px-3.5 py-3 text-sm transition-opacity duration-250 data-behind:not-data-expanded:pointer-events-none data-behind:opacity-0 data-expanded:opacity-100\">\n        <div className=\"flex gap-2\">\n          {Icon && (\n            <div\n              className=\"[&>svg]:h-lh [&>svg]:w-4 [&_svg]:pointer-events-none [&_svg]:shrink-0\"\n              data-slot=\"toast-icon\"\n            >\n              <Icon className=\"in-data-[type=loading]:animate-spin in-data-[type=error]:text-destructive in-data-[type=info]:text-info in-data-[type=success]:text-success in-data-[type=warning]:text-warning in-data-[type=loading]:opacity-80\" />\n            </div>\n          )}\n\n          <div className=\"flex flex-col gap-0.5\">\n            <Toast.Title className=\"font-medium\" data-slot=\"toast-title\" />\n            <Toast.Description\n              className=\"text-muted-foreground\"\n              data-slot=\"toast-description\"\n            />\n          </div>\n        </div>\n        {toast.actionProps && (\n          <Toast.Action\n            className={buttonVariants({ size: \"xs\" })}\n            data-slot=\"toast-action\"\n          >\n            {toast.actionProps.children}\n          </Toast.Action>\n        )}\n      </Toast.Content>\n    </Toast.Root>\n  );\n}\n\nfunction Toasts({ position = \"bottom-right\" }: { position: ToastPosition }) {\n  const { toasts } = Toast.useToastManager();\n  const isTop = position.startsWith(\"top\");\n\n  return (\n    <Toast.Portal data-slot=\"toast-portal\">\n      <Toast.Viewport\n        className={cn(\n          \"fixed z-50 mx-auto flex w-[calc(100%-var(--toast-inset)*2)] max-w-90 [--toast-inset:--spacing(4)] sm:[--toast-inset:--spacing(8)]\",\n          \"data-[position*=top]:top-(--toast-inset)\",\n          \"data-[position*=bottom]:bottom-(--toast-inset)\",\n          \"data-[position*=left]:left-(--toast-inset)\",\n          \"data-[position*=right]:right-(--toast-inset)\",\n          \"data-[position*=center]:-translate-x-1/2 data-[position*=center]:left-1/2\",\n        )}\n        data-position={position}\n        data-slot=\"toast-viewport\"\n      >\n        {toasts.map((toast) => (\n          <StackedToastItem\n            isTop={isTop}\n            key={toast.id}\n            position={position}\n            toast={toast}\n          />\n        ))}\n      </Toast.Viewport>\n    </Toast.Portal>\n  );\n}\n\nfunction AnchoredToastProvider({ children, ...props }: Toast.Provider.Props) {\n  return (\n    <Toast.Provider toastManager={anchoredToastManager.provider} {...props}>\n      {children}\n      <AnchoredToasts />\n    </Toast.Provider>\n  );\n}\n\nfunction AnchoredToastItem({\n  toast,\n}: {\n  toast: Parameters<typeof Toast.Root>[0][\"toast\"];\n}) {\n  const effectRef = useRepeatEffect(toast);\n  const Icon = toast.type\n    ? TOAST_ICONS[toast.type as keyof typeof TOAST_ICONS]\n    : null;\n  const tooltipStyle =\n    (toast.data as ToastData | undefined)?.tooltipStyle ?? false;\n  const positionerProps = toast.positionerProps;\n\n  if (!positionerProps?.anchor) {\n    return null;\n  }\n\n  return (\n    <Toast.Positioner\n      className=\"z-50 max-w-[min(--spacing(64),var(--available-width))]\"\n      data-slot=\"toast-positioner\"\n      key={toast.id}\n      sideOffset={positionerProps.sideOffset ?? 4}\n      toast={toast}\n    >\n      <Toast.Root\n        className={cn(\n          \"relative text-balance border bg-popover not-dark:bg-clip-padding text-popover-foreground text-xs transition-[scale,opacity] before:pointer-events-none before:absolute before:inset-0 before:shadow-[0_1px_--theme(--color-black/4%)] data-ending-style:scale-98 data-starting-style:scale-98 data-ending-style:opacity-0 data-starting-style:opacity-0 dark:before:shadow-[0_-1px_--theme(--color-white/6%)]\",\n          \"data-[repeat-effect=bounce]:animate-toast-bounce\",\n          \"data-[repeat-effect=shake]:animate-toast-shake\",\n          tooltipStyle\n            ? \"rounded-md shadow-md/5 before:rounded-[calc(var(--radius-md)-1px)]\"\n            : \"rounded-lg shadow-lg/5 before:rounded-[calc(var(--radius-lg)-1px)]\",\n        )}\n        data-slot=\"toast-popup\"\n        ref={effectRef}\n        toast={toast}\n      >\n        {tooltipStyle ? (\n          <Toast.Content className=\"pointer-events-auto px-2 py-1\">\n            <Toast.Title data-slot=\"toast-title\" />\n          </Toast.Content>\n        ) : (\n          <Toast.Content className=\"pointer-events-auto flex items-center justify-between gap-1.5 overflow-hidden px-3.5 py-3 text-sm\">\n            <div className=\"flex gap-2\">\n              {Icon && (\n                <div\n                  className=\"[&>svg]:h-lh [&>svg]:w-4 [&_svg]:pointer-events-none [&_svg]:shrink-0\"\n                  data-slot=\"toast-icon\"\n                >\n                  <Icon className=\"in-data-[type=loading]:animate-spin in-data-[type=error]:text-destructive in-data-[type=info]:text-info in-data-[type=success]:text-success in-data-[type=warning]:text-warning in-data-[type=loading]:opacity-80\" />\n                </div>\n              )}\n\n              <div className=\"flex flex-col gap-0.5\">\n                <Toast.Title className=\"font-medium\" data-slot=\"toast-title\" />\n                <Toast.Description\n                  className=\"text-muted-foreground\"\n                  data-slot=\"toast-description\"\n                />\n              </div>\n            </div>\n            {toast.actionProps && (\n              <Toast.Action\n                className={buttonVariants({ size: \"xs\" })}\n                data-slot=\"toast-action\"\n              >\n                {toast.actionProps.children}\n              </Toast.Action>\n            )}\n          </Toast.Content>\n        )}\n      </Toast.Root>\n    </Toast.Positioner>\n  );\n}\n\nfunction AnchoredToasts() {\n  const { toasts } = Toast.useToastManager();\n\n  return (\n    <Toast.Portal data-slot=\"toast-portal-anchored\">\n      <Toast.Viewport\n        className=\"outline-none\"\n        data-slot=\"toast-viewport-anchored\"\n      >\n        {toasts.map((toast) => (\n          <AnchoredToastItem key={toast.id} toast={toast} />\n        ))}\n      </Toast.Viewport>\n    </Toast.Portal>\n  );\n}\n\nexport {\n  ToastProvider,\n  type ToastPosition,\n  toastManager,\n  AnchoredToastProvider,\n  anchoredToastManager,\n};\n",
      "type": "registry:ui"
    }
  ],
  "cssVars": {
    "theme": {
      "--animate-toast-bounce": "toast-bounce 0.5s both",
      "--animate-toast-shake": "toast-shake 0.5s both"
    }
  },
  "css": {
    "@keyframes toast-bounce": {
      "0%": {
        "animation-timing-function": "ease-out",
        "translate": "0 0"
      },
      "28%": {
        "animation-timing-function": "ease-in",
        "translate": "0 -8px"
      },
      "48%": {
        "animation-timing-function": "ease-out",
        "translate": "0 2px"
      },
      "62%": {
        "animation-timing-function": "ease-in",
        "translate": "0 -2px"
      },
      "78%": {
        "animation-timing-function": "ease-out",
        "translate": "0 0.5px"
      },
      "100%": {
        "translate": "0 0"
      }
    },
    "@keyframes toast-shake": {
      "20%": {
        "translate": "-4px 0"
      },
      "40%": {
        "translate": "4px 0"
      },
      "60%": {
        "translate": "-4px 0"
      },
      "80%": {
        "translate": "4px 0"
      }
    }
  }
}