{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "comp-542",
  "type": "registry:component",
  "dependencies": [
    "date-fns",
    "@dnd-kit/core",
    "@dnd-kit/modifiers",
    "@dnd-kit/utilities",
    "@remixicon/react"
  ],
  "registryDependencies": [
    "https://coss.com/origin/r/button.json",
    "https://coss.com/origin/r/calendar.json",
    "https://coss.com/origin/r/checkbox.json",
    "https://coss.com/origin/r/dropdown-menu.json",
    "https://coss.com/origin/r/dialog.json",
    "https://coss.com/origin/r/input.json",
    "https://coss.com/origin/r/textarea.json",
    "https://coss.com/origin/r/label.json",
    "https://coss.com/origin/r/popover.json",
    "https://coss.com/origin/r/radio-group.json",
    "https://coss.com/origin/r/select.json",
    "https://coss.com/origin/r/sonner.json"
  ],
  "files": [
    {
      "path": "registry/default/components/comp-542.tsx",
      "content": "\"use client\";\n\nimport { addDays, setHours, setMinutes, subDays } from \"date-fns\";\nimport { useState } from \"react\";\n\nimport {\n  type CalendarEvent,\n  EventCalendar,\n} from \"@/registry/default/components/event-calendar\";\n\n// Sample events data with hardcoded times\nconst sampleEvents: CalendarEvent[] = [\n  {\n    allDay: true,\n    color: \"sky\",\n    description: \"Strategic planning for next year\",\n    end: subDays(new Date(), 23), // 23 days before today\n    id: \"1\",\n    location: \"Main Conference Hall\",\n    start: subDays(new Date(), 24), // 24 days before today\n    title: \"Annual Planning\",\n  },\n  {\n    color: \"amber\",\n    description: \"Submit final deliverables\",\n    end: setMinutes(setHours(subDays(new Date(), 9), 15), 30), // 3:30 PM, 9 days before\n    id: \"2\",\n    location: \"Office\",\n    start: setMinutes(setHours(subDays(new Date(), 9), 13), 0), // 1:00 PM, 9 days before\n    title: \"Project Deadline\",\n  },\n  {\n    allDay: true,\n    color: \"orange\",\n    description: \"Strategic planning for next year\",\n    end: subDays(new Date(), 13), // 13 days before today\n    id: \"3\",\n    location: \"Main Conference Hall\",\n    start: subDays(new Date(), 13), // 13 days before today\n    title: \"Quarterly Budget Review\",\n  },\n  {\n    color: \"sky\",\n    description: \"Weekly team sync\",\n    end: setMinutes(setHours(new Date(), 11), 0), // 11:00 AM today\n    id: \"4\",\n    location: \"Conference Room A\",\n    start: setMinutes(setHours(new Date(), 10), 0), // 10:00 AM today\n    title: \"Team Meeting\",\n  },\n  {\n    color: \"emerald\",\n    description: \"Discuss new project requirements\",\n    end: setMinutes(setHours(addDays(new Date(), 1), 13), 15), // 1:15 PM, 1 day from now\n    id: \"5\",\n    location: \"Downtown Cafe\",\n    start: setMinutes(setHours(addDays(new Date(), 1), 12), 0), // 12:00 PM, 1 day from now\n    title: \"Lunch with Client\",\n  },\n  {\n    allDay: true,\n    color: \"violet\",\n    description: \"New product release\",\n    end: addDays(new Date(), 6), // 6 days from now\n    id: \"6\",\n    start: addDays(new Date(), 3), // 3 days from now\n    title: \"Product Launch\",\n  },\n  {\n    color: \"rose\",\n    description: \"Discuss about new clients\",\n    end: setMinutes(setHours(addDays(new Date(), 5), 14), 45), // 2:45 PM, 5 days from now\n    id: \"7\",\n    location: \"Downtown Cafe\",\n    start: setMinutes(setHours(addDays(new Date(), 4), 14), 30), // 2:30 PM, 4 days from now\n    title: \"Sales Conference\",\n  },\n  {\n    color: \"orange\",\n    description: \"Weekly team sync\",\n    end: setMinutes(setHours(addDays(new Date(), 5), 10), 30), // 10:30 AM, 5 days from now\n    id: \"8\",\n    location: \"Conference Room A\",\n    start: setMinutes(setHours(addDays(new Date(), 5), 9), 0), // 9:00 AM, 5 days from now\n    title: \"Team Meeting\",\n  },\n  {\n    color: \"sky\",\n    description: \"Weekly team sync\",\n    end: setMinutes(setHours(addDays(new Date(), 5), 15), 30), // 3:30 PM, 5 days from now\n    id: \"9\",\n    location: \"Conference Room A\",\n    start: setMinutes(setHours(addDays(new Date(), 5), 14), 0), // 2:00 PM, 5 days from now\n    title: \"Review contracts\",\n  },\n  {\n    color: \"amber\",\n    description: \"Weekly team sync\",\n    end: setMinutes(setHours(addDays(new Date(), 5), 11), 0), // 11:00 AM, 5 days from now\n    id: \"10\",\n    location: \"Conference Room A\",\n    start: setMinutes(setHours(addDays(new Date(), 5), 9), 45), // 9:45 AM, 5 days from now\n    title: \"Team Meeting\",\n  },\n  {\n    color: \"emerald\",\n    description: \"Quarterly marketing planning\",\n    end: setMinutes(setHours(addDays(new Date(), 9), 15), 30), // 3:30 PM, 9 days from now\n    id: \"11\",\n    location: \"Marketing Department\",\n    start: setMinutes(setHours(addDays(new Date(), 9), 10), 0), // 10:00 AM, 9 days from now\n    title: \"Marketing Strategy Session\",\n  },\n  {\n    allDay: true,\n    color: \"sky\",\n    description: \"Presentation of yearly results\",\n    end: addDays(new Date(), 17), // 17 days from now\n    id: \"12\",\n    location: \"Grand Conference Center\",\n    start: addDays(new Date(), 17), // 17 days from now\n    title: \"Annual Shareholders Meeting\",\n  },\n  {\n    color: \"rose\",\n    description: \"Brainstorming for new features\",\n    end: setMinutes(setHours(addDays(new Date(), 27), 17), 0), // 5:00 PM, 27 days from now\n    id: \"13\",\n    location: \"Innovation Lab\",\n    start: setMinutes(setHours(addDays(new Date(), 26), 9), 0), // 9:00 AM, 26 days from now\n    title: \"Product Development Workshop\",\n  },\n];\n\nexport default function Component() {\n  const [events, setEvents] = useState<CalendarEvent[]>(sampleEvents);\n\n  const handleEventAdd = (event: CalendarEvent) => {\n    setEvents([...events, event]);\n  };\n\n  const handleEventUpdate = (updatedEvent: CalendarEvent) => {\n    setEvents(\n      events.map((event) =>\n        event.id === updatedEvent.id ? updatedEvent : event,\n      ),\n    );\n  };\n\n  const handleEventDelete = (eventId: string) => {\n    setEvents(events.filter((event) => event.id !== eventId));\n  };\n\n  return (\n    <EventCalendar\n      events={events}\n      onEventAdd={handleEventAdd}\n      onEventDelete={handleEventDelete}\n      onEventUpdate={handleEventUpdate}\n    />\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/components/event-calendar/agenda-view.tsx",
      "content": "\"use client\";\n\nimport { RiCalendarEventLine } from \"@remixicon/react\";\nimport { addDays, format, isToday } from \"date-fns\";\nimport { useMemo } from \"react\";\n\nimport {\n  AgendaDaysToShow,\n  type CalendarEvent,\n  EventItem,\n  getAgendaEventsForDay,\n} from \"@/registry/default/components/event-calendar\";\n\ninterface AgendaViewProps {\n  currentDate: Date;\n  events: CalendarEvent[];\n  onEventSelect: (event: CalendarEvent) => void;\n}\n\nexport function AgendaView({\n  currentDate,\n  events,\n  onEventSelect,\n}: AgendaViewProps) {\n  // Show events for the next days based on constant\n  const days = useMemo(() => {\n    console.log(\"Agenda view updating with date:\", currentDate.toISOString());\n    return Array.from({ length: AgendaDaysToShow }, (_, i) =>\n      addDays(new Date(currentDate), i),\n    );\n  }, [currentDate]);\n\n  const handleEventClick = (event: CalendarEvent, e: React.MouseEvent) => {\n    e.stopPropagation();\n    console.log(\"Agenda view event clicked:\", event);\n    onEventSelect(event);\n  };\n\n  // Check if there are any days with events\n  const hasEvents = days.some(\n    (day) => getAgendaEventsForDay(events, day).length > 0,\n  );\n\n  return (\n    <div className=\"border-border/70 border-t px-4\">\n      {!hasEvents ? (\n        <div className=\"flex min-h-[70svh] flex-col items-center justify-center py-16 text-center\">\n          <RiCalendarEventLine\n            className=\"mb-2 text-muted-foreground/50\"\n            size={32}\n          />\n          <h3 className=\"font-medium text-lg\">No events found</h3>\n          <p className=\"text-muted-foreground\">\n            There are no events scheduled for this time period.\n          </p>\n        </div>\n      ) : (\n        days.map((day) => {\n          const dayEvents = getAgendaEventsForDay(events, day);\n\n          if (dayEvents.length === 0) return null;\n\n          return (\n            <div\n              className=\"relative my-12 border-border/70 border-t\"\n              key={day.toString()}\n            >\n              <span\n                className=\"-top-3 absolute left-0 flex h-6 items-center bg-background pe-4 text-[10px] uppercase data-today:font-medium sm:pe-4 sm:text-xs\"\n                data-today={isToday(day) || undefined}\n              >\n                {format(day, \"d MMM, EEEE\")}\n              </span>\n              <div className=\"mt-6 space-y-2\">\n                {dayEvents.map((event) => (\n                  <EventItem\n                    event={event}\n                    key={event.id}\n                    onClick={(e) => handleEventClick(event, e)}\n                    view=\"agenda\"\n                  />\n                ))}\n              </div>\n            </div>\n          );\n        })\n      )}\n    </div>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/components/event-calendar/calendar-dnd-context.tsx",
      "content": "\"use client\";\n\nimport {\n  DndContext,\n  type DragEndEvent,\n  type DragOverEvent,\n  DragOverlay,\n  type DragStartEvent,\n  MouseSensor,\n  PointerSensor,\n  TouchSensor,\n  type UniqueIdentifier,\n  useSensor,\n  useSensors,\n} from \"@dnd-kit/core\";\nimport { addMinutes, differenceInMinutes } from \"date-fns\";\nimport {\n  createContext,\n  type ReactNode,\n  useContext,\n  useId,\n  useRef,\n  useState,\n} from \"react\";\n\nimport {\n  type CalendarEvent,\n  EventItem,\n} from \"@/registry/default/components/event-calendar\";\n\n// Define the context type\ntype CalendarDndContextType = {\n  activeEvent: CalendarEvent | null;\n  activeId: UniqueIdentifier | null;\n  activeView: \"month\" | \"week\" | \"day\" | null;\n  currentTime: Date | null;\n  eventHeight: number | null;\n  isMultiDay: boolean;\n  multiDayWidth: number | null;\n  dragHandlePosition: {\n    x?: number;\n    y?: number;\n    data?: {\n      isFirstDay?: boolean;\n      isLastDay?: boolean;\n    };\n  } | null;\n};\n\n// Create the context\nconst CalendarDndContext = createContext<CalendarDndContextType>({\n  activeEvent: null,\n  activeId: null,\n  activeView: null,\n  currentTime: null,\n  dragHandlePosition: null,\n  eventHeight: null,\n  isMultiDay: false,\n  multiDayWidth: null,\n});\n\n// Hook to use the context\nexport const useCalendarDnd = () => useContext(CalendarDndContext);\n\n// Props for the provider\ninterface CalendarDndProviderProps {\n  children: ReactNode;\n  onEventUpdate: (event: CalendarEvent) => void;\n}\n\nexport function CalendarDndProvider({\n  children,\n  onEventUpdate,\n}: CalendarDndProviderProps) {\n  const [activeEvent, setActiveEvent] = useState<CalendarEvent | null>(null);\n  const [activeId, setActiveId] = useState<UniqueIdentifier | null>(null);\n  const [activeView, setActiveView] = useState<\"month\" | \"week\" | \"day\" | null>(\n    null,\n  );\n  const [currentTime, setCurrentTime] = useState<Date | null>(null);\n  const [eventHeight, setEventHeight] = useState<number | null>(null);\n  const [isMultiDay, setIsMultiDay] = useState(false);\n  const [multiDayWidth, setMultiDayWidth] = useState<number | null>(null);\n  const [dragHandlePosition, setDragHandlePosition] = useState<{\n    x?: number;\n    y?: number;\n    data?: {\n      isFirstDay?: boolean;\n      isLastDay?: boolean;\n    };\n  } | null>(null);\n\n  // Store original event dimensions\n  const eventDimensions = useRef<{ height: number }>({ height: 0 });\n\n  // Configure sensors for better drag detection\n  const sensors = useSensors(\n    useSensor(MouseSensor, {\n      // Require the mouse to move by 5px before activating\n      activationConstraint: {\n        distance: 5,\n      },\n    }),\n    useSensor(TouchSensor, {\n      // Press delay of 250ms, with tolerance of 5px of movement\n      activationConstraint: {\n        delay: 250,\n        tolerance: 5,\n      },\n    }),\n    useSensor(PointerSensor, {\n      // Require the pointer to move by 5px before activating\n      activationConstraint: {\n        distance: 5,\n      },\n    }),\n  );\n\n  // Generate a stable ID for the DndContext\n  const dndContextId = useId();\n\n  const handleDragStart = (event: DragStartEvent) => {\n    const { active } = event;\n\n    // Add safety check for data.current\n    if (!active.data.current) {\n      console.error(\"Missing data in drag start event\", event);\n      return;\n    }\n\n    const {\n      event: calendarEvent,\n      view,\n      height,\n      isMultiDay: eventIsMultiDay,\n      multiDayWidth: eventMultiDayWidth,\n      dragHandlePosition: eventDragHandlePosition,\n    } = active.data.current as {\n      event: CalendarEvent;\n      view: \"month\" | \"week\" | \"day\";\n      height?: number;\n      isMultiDay?: boolean;\n      multiDayWidth?: number;\n      dragHandlePosition?: {\n        x?: number;\n        y?: number;\n        data?: {\n          isFirstDay?: boolean;\n          isLastDay?: boolean;\n        };\n      };\n    };\n\n    setActiveEvent(calendarEvent);\n    setActiveId(active.id);\n    setActiveView(view);\n    setCurrentTime(new Date(calendarEvent.start));\n    setIsMultiDay(eventIsMultiDay || false);\n    setMultiDayWidth(eventMultiDayWidth || null);\n    setDragHandlePosition(eventDragHandlePosition || null);\n\n    // Store event height if provided\n    if (height) {\n      eventDimensions.current.height = height;\n      setEventHeight(height);\n    }\n  };\n\n  const handleDragOver = (event: DragOverEvent) => {\n    const { over } = event;\n\n    if (over && activeEvent && over.data.current) {\n      const { date, time } = over.data.current as { date: Date; time?: number };\n\n      // Update time for week/day views\n      if (time !== undefined && activeView !== \"month\") {\n        const newTime = new Date(date);\n\n        // Calculate hours and minutes with 15-minute precision\n        const hours = Math.floor(time);\n        const fractionalHour = time - hours;\n\n        // Map to nearest 15 minute interval (0, 0.25, 0.5, 0.75)\n        let minutes = 0;\n        if (fractionalHour < 0.125) minutes = 0;\n        else if (fractionalHour < 0.375) minutes = 15;\n        else if (fractionalHour < 0.625) minutes = 30;\n        else minutes = 45;\n\n        newTime.setHours(hours, minutes, 0, 0);\n\n        // Only update if time has changed\n        if (\n          !currentTime ||\n          newTime.getHours() !== currentTime.getHours() ||\n          newTime.getMinutes() !== currentTime.getMinutes() ||\n          newTime.getDate() !== currentTime.getDate() ||\n          newTime.getMonth() !== currentTime.getMonth() ||\n          newTime.getFullYear() !== currentTime.getFullYear()\n        ) {\n          setCurrentTime(newTime);\n        }\n      } else if (activeView === \"month\") {\n        // For month view, just update the date but preserve time\n        const newTime = new Date(date);\n        if (currentTime) {\n          newTime.setHours(\n            currentTime.getHours(),\n            currentTime.getMinutes(),\n            currentTime.getSeconds(),\n            currentTime.getMilliseconds(),\n          );\n        }\n\n        // Only update if date has changed\n        if (\n          !currentTime ||\n          newTime.getDate() !== currentTime.getDate() ||\n          newTime.getMonth() !== currentTime.getMonth() ||\n          newTime.getFullYear() !== currentTime.getFullYear()\n        ) {\n          setCurrentTime(newTime);\n        }\n      }\n    }\n  };\n\n  const handleDragEnd = (event: DragEndEvent) => {\n    const { active, over } = event;\n\n    // Add robust error checking\n    if (!over || !activeEvent || !currentTime) {\n      // Reset state and exit early\n      setActiveEvent(null);\n      setActiveId(null);\n      setActiveView(null);\n      setCurrentTime(null);\n      setEventHeight(null);\n      setIsMultiDay(false);\n      setMultiDayWidth(null);\n      setDragHandlePosition(null);\n      return;\n    }\n\n    try {\n      // Safely access data with checks\n      if (!active.data.current || !over.data.current) {\n        throw new Error(\"Missing data in drag event\");\n      }\n\n      const activeData = active.data.current as {\n        event?: CalendarEvent;\n        view?: string;\n      };\n      const overData = over.data.current as { date?: Date; time?: number };\n\n      // Verify we have all required data\n      if (!activeData.event || !overData.date) {\n        throw new Error(\"Missing required event data\");\n      }\n\n      const calendarEvent = activeData.event;\n      const date = overData.date;\n      const time = overData.time;\n\n      // Calculate new start time\n      const newStart = new Date(date);\n\n      // If time is provided (for week/day views), set the hours and minutes\n      if (time !== undefined) {\n        const hours = Math.floor(time);\n        const fractionalHour = time - hours;\n\n        // Map to nearest 15 minute interval (0, 0.25, 0.5, 0.75)\n        let minutes = 0;\n        if (fractionalHour < 0.125) minutes = 0;\n        else if (fractionalHour < 0.375) minutes = 15;\n        else if (fractionalHour < 0.625) minutes = 30;\n        else minutes = 45;\n\n        newStart.setHours(hours, minutes, 0, 0);\n      } else {\n        // For month view, preserve the original time from currentTime\n        newStart.setHours(\n          currentTime.getHours(),\n          currentTime.getMinutes(),\n          currentTime.getSeconds(),\n          currentTime.getMilliseconds(),\n        );\n      }\n\n      // Calculate new end time based on the original duration\n      const originalStart = new Date(calendarEvent.start);\n      const originalEnd = new Date(calendarEvent.end);\n      const durationMinutes = differenceInMinutes(originalEnd, originalStart);\n      const newEnd = addMinutes(newStart, durationMinutes);\n\n      // Only update if the start time has actually changed\n      const hasStartTimeChanged =\n        originalStart.getFullYear() !== newStart.getFullYear() ||\n        originalStart.getMonth() !== newStart.getMonth() ||\n        originalStart.getDate() !== newStart.getDate() ||\n        originalStart.getHours() !== newStart.getHours() ||\n        originalStart.getMinutes() !== newStart.getMinutes();\n\n      if (hasStartTimeChanged) {\n        // Update the event only if the time has changed\n        onEventUpdate({\n          ...calendarEvent,\n          end: newEnd,\n          start: newStart,\n        });\n      }\n    } catch (error) {\n      console.error(\"Error in drag end handler:\", error);\n    } finally {\n      // Always reset state\n      setActiveEvent(null);\n      setActiveId(null);\n      setActiveView(null);\n      setCurrentTime(null);\n      setEventHeight(null);\n      setIsMultiDay(false);\n      setMultiDayWidth(null);\n      setDragHandlePosition(null);\n    }\n  };\n\n  return (\n    <DndContext\n      id={dndContextId}\n      onDragEnd={handleDragEnd}\n      onDragOver={handleDragOver}\n      onDragStart={handleDragStart}\n      sensors={sensors}\n    >\n      <CalendarDndContext.Provider\n        value={{\n          activeEvent,\n          activeId,\n          activeView,\n          currentTime,\n          dragHandlePosition,\n          eventHeight,\n          isMultiDay,\n          multiDayWidth,\n        }}\n      >\n        {children}\n\n        <DragOverlay adjustScale={false} dropAnimation={null}>\n          {activeEvent && activeView && (\n            <div\n              style={{\n                height: eventHeight ? `${eventHeight}px` : \"auto\",\n                width:\n                  isMultiDay && multiDayWidth ? `${multiDayWidth}%` : \"100%\",\n                // Remove the transform that was causing the shift\n              }}\n            >\n              <EventItem\n                currentTime={currentTime || undefined}\n                event={activeEvent}\n                isDragging={true}\n                isFirstDay={dragHandlePosition?.data?.isFirstDay !== false}\n                isLastDay={dragHandlePosition?.data?.isLastDay !== false}\n                showTime={activeView !== \"month\"}\n                view={activeView}\n              />\n            </div>\n          )}\n        </DragOverlay>\n      </CalendarDndContext.Provider>\n    </DndContext>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/components/event-calendar/constants.ts",
      "content": "// Height of calendar events in pixels - used in month, week and day views\nexport const EventHeight = 24;\n\n// Vertical gap between events in pixels - controls spacing in month view\nexport const EventGap = 4;\n\n// Height of hour cells in week and day views - controls the scale of time display\nexport const WeekCellsHeight = 64;\n\n// Number of days to show in the agenda view\nexport const AgendaDaysToShow = 30;\n\n// Start and end hours for the week and day views\nexport const StartHour = 0;\nexport const EndHour = 24;\n\n// Default start and end times\nexport const DefaultStartHour = 9; // 9 AM\nexport const DefaultEndHour = 10; // 10 AM\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/components/event-calendar/day-view.tsx",
      "content": "\"use client\";\n\nimport {\n  addHours,\n  areIntervalsOverlapping,\n  differenceInMinutes,\n  eachHourOfInterval,\n  format,\n  getHours,\n  getMinutes,\n  isSameDay,\n  startOfDay,\n} from \"date-fns\";\nimport type React from \"react\";\nimport { useMemo } from \"react\";\n\nimport {\n  type CalendarEvent,\n  DraggableEvent,\n  DroppableCell,\n  EventItem,\n  isMultiDayEvent,\n  useCurrentTimeIndicator,\n  WeekCellsHeight,\n} from \"@/registry/default/components/event-calendar\";\nimport {\n  EndHour,\n  StartHour,\n} from \"@/registry/default/components/event-calendar/constants\";\nimport { cn } from \"@/registry/default/lib/utils\";\n\ninterface DayViewProps {\n  currentDate: Date;\n  events: CalendarEvent[];\n  onEventSelect: (event: CalendarEvent) => void;\n  onEventCreate: (startTime: Date) => void;\n}\n\ninterface PositionedEvent {\n  event: CalendarEvent;\n  top: number;\n  height: number;\n  left: number;\n  width: number;\n  zIndex: number;\n}\n\nexport function DayView({\n  currentDate,\n  events,\n  onEventSelect,\n  onEventCreate,\n}: DayViewProps) {\n  const hours = useMemo(() => {\n    const dayStart = startOfDay(currentDate);\n    return eachHourOfInterval({\n      end: addHours(dayStart, EndHour - 1),\n      start: addHours(dayStart, StartHour),\n    });\n  }, [currentDate]);\n\n  const dayEvents = useMemo(() => {\n    return events\n      .filter((event) => {\n        const eventStart = new Date(event.start);\n        const eventEnd = new Date(event.end);\n        return (\n          isSameDay(currentDate, eventStart) ||\n          isSameDay(currentDate, eventEnd) ||\n          (currentDate > eventStart && currentDate < eventEnd)\n        );\n      })\n      .sort(\n        (a, b) => new Date(a.start).getTime() - new Date(b.start).getTime(),\n      );\n  }, [currentDate, events]);\n\n  // Filter all-day events\n  const allDayEvents = useMemo(() => {\n    return dayEvents.filter((event) => {\n      // Include explicitly marked all-day events or multi-day events\n      return event.allDay || isMultiDayEvent(event);\n    });\n  }, [dayEvents]);\n\n  // Get only single-day time-based events\n  const timeEvents = useMemo(() => {\n    return dayEvents.filter((event) => {\n      // Exclude all-day events and multi-day events\n      return !event.allDay && !isMultiDayEvent(event);\n    });\n  }, [dayEvents]);\n\n  // Process events to calculate positions\n  const positionedEvents = useMemo(() => {\n    const result: PositionedEvent[] = [];\n    const dayStart = startOfDay(currentDate);\n\n    // Sort events by start time and duration\n    const sortedEvents = [...timeEvents].sort((a, b) => {\n      const aStart = new Date(a.start);\n      const bStart = new Date(b.start);\n      const aEnd = new Date(a.end);\n      const bEnd = new Date(b.end);\n\n      // First sort by start time\n      if (aStart < bStart) return -1;\n      if (aStart > bStart) return 1;\n\n      // If start times are equal, sort by duration (longer events first)\n      const aDuration = differenceInMinutes(aEnd, aStart);\n      const bDuration = differenceInMinutes(bEnd, bStart);\n      return bDuration - aDuration;\n    });\n\n    // Track columns for overlapping events\n    const columns: { event: CalendarEvent; end: Date }[][] = [];\n\n    for (const event of sortedEvents) {\n      const eventStart = new Date(event.start);\n      const eventEnd = new Date(event.end);\n\n      // Adjust start and end times if they're outside this day\n      const adjustedStart = isSameDay(currentDate, eventStart)\n        ? eventStart\n        : dayStart;\n      const adjustedEnd = isSameDay(currentDate, eventEnd)\n        ? eventEnd\n        : addHours(dayStart, 24);\n\n      // Calculate top position and height\n      const startHour =\n        getHours(adjustedStart) + getMinutes(adjustedStart) / 60;\n      const endHour = getHours(adjustedEnd) + getMinutes(adjustedEnd) / 60;\n\n      const top = (startHour - StartHour) * WeekCellsHeight;\n      const height = (endHour - startHour) * WeekCellsHeight;\n\n      // Find a column for this event\n      let columnIndex = 0;\n      let placed = false;\n\n      while (!placed) {\n        const col = columns[columnIndex] || [];\n        if (col.length === 0) {\n          columns[columnIndex] = col;\n          placed = true;\n        } else {\n          const overlaps = col.some((c) =>\n            areIntervalsOverlapping(\n              { end: adjustedEnd, start: adjustedStart },\n              { end: new Date(c.event.end), start: new Date(c.event.start) },\n            ),\n          );\n\n          if (!overlaps) {\n            placed = true;\n          } else {\n            columnIndex++;\n          }\n        }\n      }\n\n      // Ensure column is initialized before pushing\n      const currentColumn = columns[columnIndex] || [];\n      columns[columnIndex] = currentColumn;\n      currentColumn.push({ end: adjustedEnd, event });\n\n      // First column takes full width, others are indented by 10% and take 90% width\n      const width = columnIndex === 0 ? 1 : 0.9;\n      const left = columnIndex === 0 ? 0 : columnIndex * 0.1;\n\n      result.push({\n        event,\n        height,\n        left,\n        top,\n        width,\n        zIndex: 10 + columnIndex,\n      });\n    }\n\n    return result;\n  }, [currentDate, timeEvents]);\n\n  const handleEventClick = (event: CalendarEvent, e: React.MouseEvent) => {\n    e.stopPropagation();\n    onEventSelect(event);\n  };\n\n  const showAllDaySection = allDayEvents.length > 0;\n  const { currentTimePosition, currentTimeVisible } = useCurrentTimeIndicator(\n    currentDate,\n    \"day\",\n  );\n\n  return (\n    <div className=\"contents\" data-slot=\"day-view\">\n      {showAllDaySection && (\n        <div className=\"border-border/70 border-t bg-muted/50\">\n          <div className=\"grid grid-cols-[3rem_1fr] sm:grid-cols-[4rem_1fr]\">\n            <div className=\"relative\">\n              <span className=\"absolute bottom-0 left-0 h-6 w-16 max-w-full pe-2 text-right text-[10px] text-muted-foreground/70 sm:pe-4 sm:text-xs\">\n                All day\n              </span>\n            </div>\n            <div className=\"relative border-border/70 border-r p-1 last:border-r-0\">\n              {allDayEvents.map((event) => {\n                const eventStart = new Date(event.start);\n                const eventEnd = new Date(event.end);\n                const isFirstDay = isSameDay(currentDate, eventStart);\n                const isLastDay = isSameDay(currentDate, eventEnd);\n\n                return (\n                  <EventItem\n                    event={event}\n                    isFirstDay={isFirstDay}\n                    isLastDay={isLastDay}\n                    key={`spanning-${event.id}`}\n                    onClick={(e) => handleEventClick(event, e)}\n                    view=\"month\"\n                  >\n                    {/* Always show the title in day view for better usability */}\n                    <div>{event.title}</div>\n                  </EventItem>\n                );\n              })}\n            </div>\n          </div>\n        </div>\n      )}\n\n      <div className=\"grid flex-1 grid-cols-[3rem_1fr] overflow-hidden border-border/70 border-t sm:grid-cols-[4rem_1fr]\">\n        <div>\n          {hours.map((hour, index) => (\n            <div\n              className=\"relative h-[var(--week-cells-height)] border-border/70 border-b last:border-b-0\"\n              key={hour.toString()}\n            >\n              {index > 0 && (\n                <span className=\"-top-3 absolute left-0 flex h-6 w-16 max-w-full items-center justify-end bg-background pe-2 text-[10px] text-muted-foreground/70 sm:pe-4 sm:text-xs\">\n                  {format(hour, \"h a\")}\n                </span>\n              )}\n            </div>\n          ))}\n        </div>\n\n        <div className=\"relative\">\n          {/* Positioned events */}\n          {positionedEvents.map((positionedEvent) => (\n            <div\n              className=\"absolute z-10 px-0.5\"\n              key={positionedEvent.event.id}\n              style={{\n                height: `${positionedEvent.height}px`,\n                left: `${positionedEvent.left * 100}%`,\n                top: `${positionedEvent.top}px`,\n                width: `${positionedEvent.width * 100}%`,\n                zIndex: positionedEvent.zIndex,\n              }}\n            >\n              <div className=\"size-full\">\n                <DraggableEvent\n                  event={positionedEvent.event}\n                  height={positionedEvent.height}\n                  onClick={(e) => handleEventClick(positionedEvent.event, e)}\n                  showTime\n                  view=\"day\"\n                />\n              </div>\n            </div>\n          ))}\n\n          {/* Current time indicator */}\n          {currentTimeVisible && (\n            <div\n              className=\"pointer-events-none absolute right-0 left-0 z-20\"\n              style={{ top: `${currentTimePosition}%` }}\n            >\n              <div className=\"relative flex items-center\">\n                <div className=\"-left-1 absolute h-2 w-2 rounded-full bg-primary\" />\n                <div className=\"h-[2px] w-full bg-primary\" />\n              </div>\n            </div>\n          )}\n\n          {/* Time grid */}\n          {hours.map((hour) => {\n            const hourValue = getHours(hour);\n            return (\n              <div\n                className=\"relative h-[var(--week-cells-height)] border-border/70 border-b last:border-b-0\"\n                key={hour.toString()}\n              >\n                {/* Quarter-hour intervals */}\n                {[0, 1, 2, 3].map((quarter) => {\n                  const quarterHourTime = hourValue + quarter * 0.25;\n                  return (\n                    <DroppableCell\n                      className={cn(\n                        \"absolute h-[calc(var(--week-cells-height)/4)] w-full\",\n                        quarter === 0 && \"top-0\",\n                        quarter === 1 &&\n                          \"top-[calc(var(--week-cells-height)/4)]\",\n                        quarter === 2 &&\n                          \"top-[calc(var(--week-cells-height)/4*2)]\",\n                        quarter === 3 &&\n                          \"top-[calc(var(--week-cells-height)/4*3)]\",\n                      )}\n                      date={currentDate}\n                      id={`day-cell-${currentDate.toISOString()}-${quarterHourTime}`}\n                      key={`${hour.toString()}-${quarter}`}\n                      onClick={() => {\n                        const startTime = new Date(currentDate);\n                        startTime.setHours(hourValue);\n                        startTime.setMinutes(quarter * 15);\n                        onEventCreate(startTime);\n                      }}\n                      time={quarterHourTime}\n                    />\n                  );\n                })}\n              </div>\n            );\n          })}\n        </div>\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/components/event-calendar/draggable-event.tsx",
      "content": "\"use client\";\n\nimport { useDraggable } from \"@dnd-kit/core\";\nimport { CSS } from \"@dnd-kit/utilities\";\nimport { differenceInDays } from \"date-fns\";\nimport { useRef, useState } from \"react\";\n\nimport {\n  type CalendarEvent,\n  EventItem,\n  useCalendarDnd,\n} from \"@/registry/default/components/event-calendar\";\n\ninterface DraggableEventProps {\n  event: CalendarEvent;\n  view: \"month\" | \"week\" | \"day\";\n  showTime?: boolean;\n  onClick?: (e: React.MouseEvent) => void;\n  height?: number;\n  isMultiDay?: boolean;\n  multiDayWidth?: number;\n  isFirstDay?: boolean;\n  isLastDay?: boolean;\n  \"aria-hidden\"?: boolean | \"true\" | \"false\";\n}\n\nexport function DraggableEvent({\n  event,\n  view,\n  showTime,\n  onClick,\n  height,\n  isMultiDay,\n  multiDayWidth,\n  isFirstDay = true,\n  isLastDay = true,\n  \"aria-hidden\": ariaHidden,\n}: DraggableEventProps) {\n  const { activeId } = useCalendarDnd();\n  const elementRef = useRef<HTMLDivElement>(null);\n  const [dragHandlePosition, setDragHandlePosition] = useState<{\n    x: number;\n    y: number;\n  } | null>(null);\n\n  // Check if this is a multi-day event\n  const eventStart = new Date(event.start);\n  const eventEnd = new Date(event.end);\n  const isMultiDayEvent =\n    isMultiDay || event.allDay || differenceInDays(eventEnd, eventStart) >= 1;\n\n  const { attributes, listeners, setNodeRef, transform, isDragging } =\n    useDraggable({\n      data: {\n        dragHandlePosition,\n        event,\n        height: height || elementRef.current?.offsetHeight || null,\n        isFirstDay,\n        isLastDay,\n        isMultiDay: isMultiDayEvent,\n        multiDayWidth: multiDayWidth,\n        view,\n      },\n      id: `${event.id}-${view}`,\n    });\n\n  // Handle mouse down to track where on the event the user clicked\n  const handleMouseDown = (e: React.MouseEvent) => {\n    if (elementRef.current) {\n      const rect = elementRef.current.getBoundingClientRect();\n      setDragHandlePosition({\n        x: e.clientX - rect.left,\n        y: e.clientY - rect.top,\n      });\n    }\n  };\n\n  // Don't render if this event is being dragged\n  if (isDragging || activeId === `${event.id}-${view}`) {\n    return (\n      <div\n        className=\"opacity-0\"\n        ref={setNodeRef}\n        style={{ height: height || \"auto\" }}\n      />\n    );\n  }\n\n  const style = transform\n    ? {\n        height: height || \"auto\",\n        transform: CSS.Translate.toString(transform),\n        width:\n          isMultiDayEvent && multiDayWidth ? `${multiDayWidth}%` : undefined,\n      }\n    : {\n        height: height || \"auto\",\n        width:\n          isMultiDayEvent && multiDayWidth ? `${multiDayWidth}%` : undefined,\n      };\n\n  // Handle touch start to track where on the event the user touched\n  const handleTouchStart = (e: React.TouchEvent) => {\n    if (elementRef.current) {\n      const rect = elementRef.current.getBoundingClientRect();\n      const touch = e.touches[0];\n      if (touch) {\n        setDragHandlePosition({\n          x: touch.clientX - rect.left,\n          y: touch.clientY - rect.top,\n        });\n      }\n    }\n  };\n\n  return (\n    <div\n      className=\"touch-none\"\n      ref={(node) => {\n        setNodeRef(node);\n        if (elementRef) elementRef.current = node;\n      }}\n      style={style}\n    >\n      <EventItem\n        aria-hidden={ariaHidden}\n        dndAttributes={attributes}\n        dndListeners={listeners}\n        event={event}\n        isDragging={isDragging}\n        isFirstDay={isFirstDay}\n        isLastDay={isLastDay}\n        onClick={onClick}\n        onMouseDown={handleMouseDown}\n        onTouchStart={handleTouchStart}\n        showTime={showTime}\n        view={view}\n      />\n    </div>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/components/event-calendar/droppable-cell.tsx",
      "content": "\"use client\";\n\nimport { useDroppable } from \"@dnd-kit/core\";\n\nimport { useCalendarDnd } from \"@/registry/default/components/event-calendar\";\nimport { cn } from \"@/registry/default/lib/utils\";\n\ninterface DroppableCellProps {\n  id: string;\n  date: Date;\n  time?: number; // For week/day views, represents hours (e.g., 9.25 for 9:15)\n  children?: React.ReactNode;\n  className?: string;\n  onClick?: () => void;\n}\n\nexport function DroppableCell({\n  id,\n  date,\n  time,\n  children,\n  className,\n  onClick,\n}: DroppableCellProps) {\n  const { activeEvent } = useCalendarDnd();\n\n  const { setNodeRef, isOver } = useDroppable({\n    data: {\n      date,\n      time,\n    },\n    id,\n  });\n\n  // Format time for display in tooltip (only for debugging)\n  const formattedTime =\n    time !== undefined\n      ? `${Math.floor(time)}:${Math.round((time - Math.floor(time)) * 60)\n          .toString()\n          .padStart(2, \"0\")}`\n      : null;\n\n  return (\n    <div\n      className={cn(\n        \"flex h-full flex-col overflow-hidden px-0.5 py-1 data-dragging:bg-accent sm:px-1\",\n        className,\n      )}\n      data-dragging={isOver && activeEvent ? true : undefined}\n      onClick={onClick}\n      ref={setNodeRef}\n      title={formattedTime ? `${formattedTime}` : undefined}\n    >\n      {children}\n    </div>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/components/event-calendar/event-dialog.tsx",
      "content": "\"use client\";\n\nimport { RiCalendarLine, RiDeleteBinLine } from \"@remixicon/react\";\nimport { format, isBefore } from \"date-fns\";\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\n\nimport type {\n  CalendarEvent,\n  EventColor,\n} from \"@/registry/default/components/event-calendar\";\nimport {\n  DefaultEndHour,\n  DefaultStartHour,\n  EndHour,\n  StartHour,\n} from \"@/registry/default/components/event-calendar/constants\";\nimport { cn } from \"@/registry/default/lib/utils\";\nimport { Button } from \"@/registry/default/ui/button\";\nimport { Calendar } from \"@/registry/default/ui/calendar\";\nimport { Checkbox } from \"@/registry/default/ui/checkbox\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/registry/default/ui/dialog\";\nimport { Input } from \"@/registry/default/ui/input\";\nimport { Label } from \"@/registry/default/ui/label\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/registry/default/ui/popover\";\nimport { RadioGroup, RadioGroupItem } from \"@/registry/default/ui/radio-group\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/registry/default/ui/select\";\nimport { Textarea } from \"@/registry/default/ui/textarea\";\n\ninterface EventDialogProps {\n  event: CalendarEvent | null;\n  isOpen: boolean;\n  onClose: () => void;\n  onSave: (event: CalendarEvent) => void;\n  onDelete: (eventId: string) => void;\n}\n\nexport function EventDialog({\n  event,\n  isOpen,\n  onClose,\n  onSave,\n  onDelete,\n}: EventDialogProps) {\n  const [title, setTitle] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [startDate, setStartDate] = useState<Date>(new Date());\n  const [endDate, setEndDate] = useState<Date>(new Date());\n  const [startTime, setStartTime] = useState(`${DefaultStartHour}:00`);\n  const [endTime, setEndTime] = useState(`${DefaultEndHour}:00`);\n  const [allDay, setAllDay] = useState(false);\n  const [location, setLocation] = useState(\"\");\n  const [color, setColor] = useState<EventColor>(\"sky\");\n  const [error, setError] = useState<string | null>(null);\n  const [startDateOpen, setStartDateOpen] = useState(false);\n  const [endDateOpen, setEndDateOpen] = useState(false);\n\n  // Debug log to check what event is being passed\n  useEffect(() => {\n    console.log(\"EventDialog received event:\", event);\n  }, [event]);\n\n  const resetForm = useCallback(() => {\n    setTitle(\"\");\n    setDescription(\"\");\n    setStartDate(new Date());\n    setEndDate(new Date());\n    setStartTime(`${DefaultStartHour}:00`);\n    setEndTime(`${DefaultEndHour}:00`);\n    setAllDay(false);\n    setLocation(\"\");\n    setColor(\"sky\");\n    setError(null);\n  }, []);\n\n  const formatTimeForInput = useCallback((date: Date) => {\n    const hours = date.getHours().toString().padStart(2, \"0\");\n    const minutes = Math.floor(date.getMinutes() / 15) * 15;\n    return `${hours}:${minutes.toString().padStart(2, \"0\")}`;\n  }, []);\n\n  useEffect(() => {\n    if (event) {\n      setTitle(event.title || \"\");\n      setDescription(event.description || \"\");\n\n      const start = new Date(event.start);\n      const end = new Date(event.end);\n\n      setStartDate(start);\n      setEndDate(end);\n      setStartTime(formatTimeForInput(start));\n      setEndTime(formatTimeForInput(end));\n      setAllDay(event.allDay || false);\n      setLocation(event.location || \"\");\n      setColor((event.color as EventColor) || \"sky\");\n      setError(null); // Reset error when opening dialog\n    } else {\n      resetForm();\n    }\n  }, [event, formatTimeForInput, resetForm]);\n\n  // Memoize time options so they're only calculated once\n  const timeOptions = useMemo(() => {\n    const options = [];\n    for (let hour = StartHour; hour <= EndHour; hour++) {\n      for (let minute = 0; minute < 60; minute += 15) {\n        const formattedHour = hour.toString().padStart(2, \"0\");\n        const formattedMinute = minute.toString().padStart(2, \"0\");\n        const value = `${formattedHour}:${formattedMinute}`;\n        // Use a fixed date to avoid unnecessary date object creations\n        const date = new Date(2000, 0, 1, hour, minute);\n        const label = format(date, \"h:mm a\");\n        options.push({ label, value });\n      }\n    }\n    return options;\n  }, []); // Empty dependency array ensures this only runs once\n\n  const handleSave = () => {\n    const start = new Date(startDate);\n    const end = new Date(endDate);\n\n    if (!allDay) {\n      const [startHours = 0, startMinutes = 0] = startTime\n        .split(\":\")\n        .map(Number);\n      const [endHours = 0, endMinutes = 0] = endTime.split(\":\").map(Number);\n\n      if (\n        startHours < StartHour ||\n        startHours > EndHour ||\n        endHours < StartHour ||\n        endHours > EndHour\n      ) {\n        setError(\n          `Selected time must be between ${StartHour}:00 and ${EndHour}:00`,\n        );\n        return;\n      }\n\n      start.setHours(startHours, startMinutes, 0);\n      end.setHours(endHours, endMinutes, 0);\n    } else {\n      start.setHours(0, 0, 0, 0);\n      end.setHours(23, 59, 59, 999);\n    }\n\n    // Validate that end date is not before start date\n    if (isBefore(end, start)) {\n      setError(\"End date cannot be before start date\");\n      return;\n    }\n\n    // Use generic title if empty\n    const eventTitle = title.trim() ? title : \"(no title)\";\n\n    onSave({\n      allDay,\n      color,\n      description,\n      end,\n      id: event?.id || \"\",\n      location,\n      start,\n      title: eventTitle,\n    });\n  };\n\n  const handleDelete = () => {\n    if (event?.id) {\n      onDelete(event.id);\n    }\n  };\n\n  // Updated color options to match types.ts\n  const colorOptions: Array<{\n    value: EventColor;\n    label: string;\n    bgClass: string;\n    borderClass: string;\n  }> = [\n    {\n      bgClass: \"bg-sky-400 data-[state=checked]:bg-sky-400\",\n      borderClass: \"border-sky-400 data-[state=checked]:border-sky-400\",\n      label: \"Sky\",\n      value: \"sky\",\n    },\n    {\n      bgClass: \"bg-amber-400 data-[state=checked]:bg-amber-400\",\n      borderClass: \"border-amber-400 data-[state=checked]:border-amber-400\",\n      label: \"Amber\",\n      value: \"amber\",\n    },\n    {\n      bgClass: \"bg-violet-400 data-[state=checked]:bg-violet-400\",\n      borderClass: \"border-violet-400 data-[state=checked]:border-violet-400\",\n      label: \"Violet\",\n      value: \"violet\",\n    },\n    {\n      bgClass: \"bg-rose-400 data-[state=checked]:bg-rose-400\",\n      borderClass: \"border-rose-400 data-[state=checked]:border-rose-400\",\n      label: \"Rose\",\n      value: \"rose\",\n    },\n    {\n      bgClass: \"bg-emerald-400 data-[state=checked]:bg-emerald-400\",\n      borderClass: \"border-emerald-400 data-[state=checked]:border-emerald-400\",\n      label: \"Emerald\",\n      value: \"emerald\",\n    },\n    {\n      bgClass: \"bg-orange-400 data-[state=checked]:bg-orange-400\",\n      borderClass: \"border-orange-400 data-[state=checked]:border-orange-400\",\n      label: \"Orange\",\n      value: \"orange\",\n    },\n  ];\n\n  return (\n    <Dialog onOpenChange={(open) => !open && onClose()} open={isOpen}>\n      <DialogContent className=\"sm:max-w-[425px]\">\n        <DialogHeader>\n          <DialogTitle>{event?.id ? \"Edit Event\" : \"Create Event\"}</DialogTitle>\n          <DialogDescription className=\"sr-only\">\n            {event?.id\n              ? \"Edit the details of this event\"\n              : \"Add a new event to your calendar\"}\n          </DialogDescription>\n        </DialogHeader>\n        {error && (\n          <div className=\"rounded-md bg-destructive/15 px-3 py-2 text-destructive text-sm\">\n            {error}\n          </div>\n        )}\n        <div className=\"grid gap-4 py-4\">\n          <div className=\"*:not-first:mt-1.5\">\n            <Label htmlFor=\"title\">Title</Label>\n            <Input\n              id=\"title\"\n              onChange={(e) => setTitle(e.target.value)}\n              value={title}\n            />\n          </div>\n\n          <div className=\"*:not-first:mt-1.5\">\n            <Label htmlFor=\"description\">Description</Label>\n            <Textarea\n              id=\"description\"\n              onChange={(e) => setDescription(e.target.value)}\n              rows={3}\n              value={description}\n            />\n          </div>\n\n          <div className=\"flex gap-4\">\n            <div className=\"flex-1 *:not-first:mt-1.5\">\n              <Label htmlFor=\"start-date\">Start Date</Label>\n              <Popover onOpenChange={setStartDateOpen} open={startDateOpen}>\n                <PopoverTrigger asChild>\n                  <Button\n                    className={cn(\n                      \"group w-full justify-between border-input bg-background px-3 font-normal outline-none outline-offset-0 hover:bg-background focus-visible:outline-[3px]\",\n                      !startDate && \"text-muted-foreground\",\n                    )}\n                    id=\"start-date\"\n                    variant={\"outline\"}\n                  >\n                    <span\n                      className={cn(\n                        \"truncate\",\n                        !startDate && \"text-muted-foreground\",\n                      )}\n                    >\n                      {startDate ? format(startDate, \"PPP\") : \"Pick a date\"}\n                    </span>\n                    <RiCalendarLine\n                      aria-hidden=\"true\"\n                      className=\"shrink-0 text-muted-foreground/80\"\n                      size={16}\n                    />\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent align=\"start\" className=\"w-auto p-2\">\n                  <Calendar\n                    defaultMonth={startDate}\n                    mode=\"single\"\n                    onSelect={(date) => {\n                      if (date) {\n                        setStartDate(date);\n                        // If end date is before the new start date, update it to match the start date\n                        if (isBefore(endDate, date)) {\n                          setEndDate(date);\n                        }\n                        setError(null);\n                        setStartDateOpen(false);\n                      }\n                    }}\n                    selected={startDate}\n                  />\n                </PopoverContent>\n              </Popover>\n            </div>\n\n            {!allDay && (\n              <div className=\"min-w-28 *:not-first:mt-1.5\">\n                <Label htmlFor=\"start-time\">Start Time</Label>\n                <Select onValueChange={setStartTime} value={startTime}>\n                  <SelectTrigger id=\"start-time\">\n                    <SelectValue placeholder=\"Select time\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {timeOptions.map((option) => (\n                      <SelectItem key={option.value} value={option.value}>\n                        {option.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n          </div>\n\n          <div className=\"flex gap-4\">\n            <div className=\"flex-1 *:not-first:mt-1.5\">\n              <Label htmlFor=\"end-date\">End Date</Label>\n              <Popover onOpenChange={setEndDateOpen} open={endDateOpen}>\n                <PopoverTrigger asChild>\n                  <Button\n                    className={cn(\n                      \"group w-full justify-between border-input bg-background px-3 font-normal outline-none outline-offset-0 hover:bg-background focus-visible:outline-[3px]\",\n                      !endDate && \"text-muted-foreground\",\n                    )}\n                    id=\"end-date\"\n                    variant={\"outline\"}\n                  >\n                    <span\n                      className={cn(\n                        \"truncate\",\n                        !endDate && \"text-muted-foreground\",\n                      )}\n                    >\n                      {endDate ? format(endDate, \"PPP\") : \"Pick a date\"}\n                    </span>\n                    <RiCalendarLine\n                      aria-hidden=\"true\"\n                      className=\"shrink-0 text-muted-foreground/80\"\n                      size={16}\n                    />\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent align=\"start\" className=\"w-auto p-2\">\n                  <Calendar\n                    defaultMonth={endDate}\n                    disabled={{ before: startDate }}\n                    mode=\"single\"\n                    onSelect={(date) => {\n                      if (date) {\n                        setEndDate(date);\n                        setError(null);\n                        setEndDateOpen(false);\n                      }\n                    }}\n                    selected={endDate}\n                  />\n                </PopoverContent>\n              </Popover>\n            </div>\n\n            {!allDay && (\n              <div className=\"min-w-28 *:not-first:mt-1.5\">\n                <Label htmlFor=\"end-time\">End Time</Label>\n                <Select onValueChange={setEndTime} value={endTime}>\n                  <SelectTrigger id=\"end-time\">\n                    <SelectValue placeholder=\"Select time\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {timeOptions.map((option) => (\n                      <SelectItem key={option.value} value={option.value}>\n                        {option.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <Checkbox\n              checked={allDay}\n              id=\"all-day\"\n              onCheckedChange={(checked) => setAllDay(checked === true)}\n            />\n            <Label htmlFor=\"all-day\">All day</Label>\n          </div>\n\n          <div className=\"*:not-first:mt-1.5\">\n            <Label htmlFor=\"location\">Location</Label>\n            <Input\n              id=\"location\"\n              onChange={(e) => setLocation(e.target.value)}\n              value={location}\n            />\n          </div>\n          <fieldset className=\"space-y-4\">\n            <legend className=\"font-medium text-foreground text-sm leading-none\">\n              Etiquette\n            </legend>\n            <RadioGroup\n              className=\"flex gap-1.5\"\n              defaultValue={colorOptions[0]?.value}\n              onValueChange={(value: EventColor) => setColor(value)}\n              value={color}\n            >\n              {colorOptions.map((colorOption) => (\n                <RadioGroupItem\n                  aria-label={colorOption.label}\n                  className={cn(\n                    \"size-6 shadow-none\",\n                    colorOption.bgClass,\n                    colorOption.borderClass,\n                  )}\n                  id={`color-${colorOption.value}`}\n                  key={colorOption.value}\n                  value={colorOption.value}\n                />\n              ))}\n            </RadioGroup>\n          </fieldset>\n        </div>\n        <DialogFooter className=\"flex-row sm:justify-between\">\n          {event?.id && (\n            <Button\n              aria-label=\"Delete event\"\n              onClick={handleDelete}\n              size=\"icon\"\n              variant=\"outline\"\n            >\n              <RiDeleteBinLine aria-hidden=\"true\" size={16} />\n            </Button>\n          )}\n          <div className=\"flex flex-1 justify-end gap-2\">\n            <Button onClick={onClose} variant=\"outline\">\n              Cancel\n            </Button>\n            <Button onClick={handleSave}>Save</Button>\n          </div>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/components/event-calendar/event-item.tsx",
      "content": "\"use client\";\n\nimport type { DraggableAttributes } from \"@dnd-kit/core\";\nimport type { SyntheticListenerMap } from \"@dnd-kit/core/dist/hooks/utilities\";\nimport { differenceInMinutes, format, getMinutes, isPast } from \"date-fns\";\nimport { useMemo } from \"react\";\n\nimport {\n  type CalendarEvent,\n  getBorderRadiusClasses,\n  getEventColorClasses,\n} from \"@/registry/default/components/event-calendar\";\nimport { cn } from \"@/registry/default/lib/utils\";\n\n// Using date-fns format with custom formatting:\n// 'h' - hours (1-12)\n// 'a' - am/pm\n// ':mm' - minutes with leading zero (only if the token 'mm' is present)\nconst formatTimeWithOptionalMinutes = (date: Date) => {\n  return format(date, getMinutes(date) === 0 ? \"ha\" : \"h:mma\").toLowerCase();\n};\n\ninterface EventWrapperProps {\n  event: CalendarEvent;\n  isFirstDay?: boolean;\n  isLastDay?: boolean;\n  isDragging?: boolean;\n  onClick?: (e: React.MouseEvent) => void;\n  className?: string;\n  children: React.ReactNode;\n  currentTime?: Date;\n  dndListeners?: SyntheticListenerMap;\n  dndAttributes?: DraggableAttributes;\n  onMouseDown?: (e: React.MouseEvent) => void;\n  onTouchStart?: (e: React.TouchEvent) => void;\n}\n\n// Shared wrapper component for event styling\nfunction EventWrapper({\n  event,\n  isFirstDay = true,\n  isLastDay = true,\n  isDragging,\n  onClick,\n  className,\n  children,\n  currentTime,\n  dndListeners,\n  dndAttributes,\n  onMouseDown,\n  onTouchStart,\n}: EventWrapperProps) {\n  // Always use the currentTime (if provided) to determine if the event is in the past\n  const displayEnd = currentTime\n    ? new Date(\n        new Date(currentTime).getTime() +\n          (new Date(event.end).getTime() - new Date(event.start).getTime()),\n      )\n    : new Date(event.end);\n\n  const isEventInPast = isPast(displayEnd);\n\n  return (\n    <button\n      className={cn(\n        \"flex size-full select-none overflow-hidden px-1 text-left font-medium outline-none backdrop-blur-md transition focus-visible:border-ring focus-visible:ring-[3px] focus-visible:ring-ring/50 data-dragging:cursor-grabbing data-past-event:line-through data-dragging:shadow-lg sm:px-2\",\n        getEventColorClasses(event.color),\n        getBorderRadiusClasses(isFirstDay, isLastDay),\n        className,\n      )}\n      data-dragging={isDragging || undefined}\n      data-past-event={isEventInPast || undefined}\n      onClick={onClick}\n      onMouseDown={onMouseDown}\n      onTouchStart={onTouchStart}\n      type=\"button\"\n      {...dndListeners}\n      {...dndAttributes}\n    >\n      {children}\n    </button>\n  );\n}\n\ninterface EventItemProps {\n  event: CalendarEvent;\n  view: \"month\" | \"week\" | \"day\" | \"agenda\";\n  isDragging?: boolean;\n  onClick?: (e: React.MouseEvent) => void;\n  showTime?: boolean;\n  currentTime?: Date; // For updating time during drag\n  isFirstDay?: boolean;\n  isLastDay?: boolean;\n  children?: React.ReactNode;\n  className?: string;\n  dndListeners?: SyntheticListenerMap;\n  dndAttributes?: DraggableAttributes;\n  onMouseDown?: (e: React.MouseEvent) => void;\n  onTouchStart?: (e: React.TouchEvent) => void;\n}\n\nexport function EventItem({\n  event,\n  view,\n  isDragging,\n  onClick,\n  showTime,\n  currentTime,\n  isFirstDay = true,\n  isLastDay = true,\n  children,\n  className,\n  dndListeners,\n  dndAttributes,\n  onMouseDown,\n  onTouchStart,\n}: EventItemProps) {\n  const eventColor = event.color;\n\n  // Use the provided currentTime (for dragging) or the event's actual time\n  const displayStart = useMemo(() => {\n    return currentTime || new Date(event.start);\n  }, [currentTime, event.start]);\n\n  const displayEnd = useMemo(() => {\n    return currentTime\n      ? new Date(\n          new Date(currentTime).getTime() +\n            (new Date(event.end).getTime() - new Date(event.start).getTime()),\n        )\n      : new Date(event.end);\n  }, [currentTime, event.start, event.end]);\n\n  // Calculate event duration in minutes\n  const durationMinutes = useMemo(() => {\n    return differenceInMinutes(displayEnd, displayStart);\n  }, [displayStart, displayEnd]);\n\n  const getEventTime = () => {\n    if (event.allDay) return \"All day\";\n\n    // For short events (less than 45 minutes), only show start time\n    if (durationMinutes < 45) {\n      return formatTimeWithOptionalMinutes(displayStart);\n    }\n\n    // For longer events, show both start and end time\n    return `${formatTimeWithOptionalMinutes(displayStart)} - ${formatTimeWithOptionalMinutes(displayEnd)}`;\n  };\n\n  if (view === \"month\") {\n    return (\n      <EventWrapper\n        className={cn(\n          \"mt-[var(--event-gap)] h-[var(--event-height)] items-center text-[10px] sm:text-xs\",\n          className,\n        )}\n        currentTime={currentTime}\n        dndAttributes={dndAttributes}\n        dndListeners={dndListeners}\n        event={event}\n        isDragging={isDragging}\n        isFirstDay={isFirstDay}\n        isLastDay={isLastDay}\n        onClick={onClick}\n        onMouseDown={onMouseDown}\n        onTouchStart={onTouchStart}\n      >\n        {children || (\n          <span className=\"truncate\">\n            {!event.allDay && (\n              <span className=\"truncate font-normal opacity-70 sm:text-[11px]\">\n                {formatTimeWithOptionalMinutes(displayStart)}{\" \"}\n              </span>\n            )}\n            {event.title}\n          </span>\n        )}\n      </EventWrapper>\n    );\n  }\n\n  if (view === \"week\" || view === \"day\") {\n    return (\n      <EventWrapper\n        className={cn(\n          \"py-1\",\n          durationMinutes < 45 ? \"items-center\" : \"flex-col\",\n          view === \"week\" ? \"text-[10px] sm:text-xs\" : \"text-xs\",\n          className,\n        )}\n        currentTime={currentTime}\n        dndAttributes={dndAttributes}\n        dndListeners={dndListeners}\n        event={event}\n        isDragging={isDragging}\n        isFirstDay={isFirstDay}\n        isLastDay={isLastDay}\n        onClick={onClick}\n        onMouseDown={onMouseDown}\n        onTouchStart={onTouchStart}\n      >\n        {durationMinutes < 45 ? (\n          <div className=\"truncate\">\n            {event.title}{\" \"}\n            {showTime && (\n              <span className=\"opacity-70\">\n                {formatTimeWithOptionalMinutes(displayStart)}\n              </span>\n            )}\n          </div>\n        ) : (\n          <>\n            <div className=\"truncate font-medium\">{event.title}</div>\n            {showTime && (\n              <div className=\"truncate font-normal opacity-70 sm:text-[11px]\">\n                {getEventTime()}\n              </div>\n            )}\n          </>\n        )}\n      </EventWrapper>\n    );\n  }\n\n  // Agenda view - kept separate since it's significantly different\n  return (\n    <button\n      className={cn(\n        \"flex w-full flex-col gap-1 rounded p-2 text-left outline-none transition focus-visible:border-ring focus-visible:ring-[3px] focus-visible:ring-ring/50 data-past-event:line-through data-past-event:opacity-90\",\n        getEventColorClasses(eventColor),\n        className,\n      )}\n      data-past-event={isPast(new Date(event.end)) || undefined}\n      onClick={onClick}\n      onMouseDown={onMouseDown}\n      onTouchStart={onTouchStart}\n      type=\"button\"\n      {...dndListeners}\n      {...dndAttributes}\n    >\n      <div className=\"font-medium text-sm\">{event.title}</div>\n      <div className=\"text-xs opacity-70\">\n        {event.allDay ? (\n          <span>All day</span>\n        ) : (\n          <span className=\"uppercase\">\n            {formatTimeWithOptionalMinutes(displayStart)} -{\" \"}\n            {formatTimeWithOptionalMinutes(displayEnd)}\n          </span>\n        )}\n        {event.location && (\n          <>\n            <span className=\"px-1 opacity-35\">  </span>\n            <span>{event.location}</span>\n          </>\n        )}\n      </div>\n      {event.description && (\n        <div className=\"my-1 text-xs opacity-90\">{event.description}</div>\n      )}\n    </button>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/components/event-calendar/events-popup.tsx",
      "content": "\"use client\";\n\nimport { format, isSameDay } from \"date-fns\";\nimport { XIcon } from \"lucide-react\";\nimport { useEffect, useMemo, useRef } from \"react\";\n\nimport {\n  type CalendarEvent,\n  EventItem,\n} from \"@/registry/default/components/event-calendar\";\n\ninterface EventsPopupProps {\n  date: Date;\n  events: CalendarEvent[];\n  position: { top: number; left: number };\n  onClose: () => void;\n  onEventSelect: (event: CalendarEvent) => void;\n}\n\nexport function EventsPopup({\n  date,\n  events,\n  position,\n  onClose,\n  onEventSelect,\n}: EventsPopupProps) {\n  const popupRef = useRef<HTMLDivElement>(null);\n\n  // Handle click outside to close popup\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (\n        popupRef.current &&\n        !popupRef.current.contains(event.target as Node)\n      ) {\n        onClose();\n      }\n    };\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  }, [onClose]);\n\n  // Handle escape key to close popup\n  useEffect(() => {\n    const handleEscKey = (event: KeyboardEvent) => {\n      if (event.key === \"Escape\") {\n        onClose();\n      }\n    };\n\n    document.addEventListener(\"keydown\", handleEscKey);\n    return () => {\n      document.removeEventListener(\"keydown\", handleEscKey);\n    };\n  }, [onClose]);\n\n  const handleEventClick = (event: CalendarEvent) => {\n    onEventSelect(event);\n    onClose();\n  };\n\n  // Adjust position to ensure popup stays within viewport\n  const adjustedPosition = useMemo(() => {\n    const positionCopy = { ...position };\n\n    // Check if we need to adjust the position to fit in the viewport\n    if (popupRef.current) {\n      const rect = popupRef.current.getBoundingClientRect();\n      const viewportWidth = window.innerWidth;\n      const viewportHeight = window.innerHeight;\n\n      // Adjust horizontally if needed\n      if (positionCopy.left + rect.width > viewportWidth) {\n        positionCopy.left = Math.max(0, viewportWidth - rect.width);\n      }\n\n      // Adjust vertically if needed\n      if (positionCopy.top + rect.height > viewportHeight) {\n        positionCopy.top = Math.max(0, viewportHeight - rect.height);\n      }\n    }\n\n    return positionCopy;\n  }, [position]);\n\n  return (\n    <div\n      className=\"absolute z-50 max-h-96 w-80 overflow-auto rounded-md border bg-background shadow-lg\"\n      ref={popupRef}\n      style={{\n        left: `${adjustedPosition.left}px`,\n        top: `${adjustedPosition.top}px`,\n      }}\n    >\n      <div className=\"sticky top-0 flex items-center justify-between border-b bg-background p-3\">\n        <h3 className=\"font-medium\">{format(date, \"d MMMM yyyy\")}</h3>\n        <button\n          aria-label=\"Close\"\n          className=\"rounded-full p-1 hover:bg-muted\"\n          onClick={onClose}\n          type=\"button\"\n        >\n          <XIcon className=\"h-4 w-4\" />\n        </button>\n      </div>\n\n      <div className=\"space-y-2 p-3\">\n        {events.length === 0 ? (\n          <div className=\"py-2 text-muted-foreground text-sm\">No events</div>\n        ) : (\n          events.map((event) => {\n            const eventStart = new Date(event.start);\n            const eventEnd = new Date(event.end);\n            const isFirstDay = isSameDay(date, eventStart);\n            const isLastDay = isSameDay(date, eventEnd);\n\n            return (\n              <div\n                className=\"cursor-pointer\"\n                key={event.id}\n                onClick={() => handleEventClick(event)}\n              >\n                <EventItem\n                  event={event}\n                  isFirstDay={isFirstDay}\n                  isLastDay={isLastDay}\n                  view=\"agenda\"\n                />\n              </div>\n            );\n          })\n        )}\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/components/event-calendar/event-calendar.tsx",
      "content": "\"use client\";\n\nimport { RiCalendarCheckLine } from \"@remixicon/react\";\nimport {\n  addDays,\n  addMonths,\n  addWeeks,\n  endOfWeek,\n  format,\n  isSameMonth,\n  startOfWeek,\n  subMonths,\n  subWeeks,\n} from \"date-fns\";\nimport {\n  ChevronDownIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon,\n  PlusIcon,\n} from \"lucide-react\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { toast } from \"sonner\";\n\nimport {\n  AgendaDaysToShow,\n  AgendaView,\n  addHoursToDate,\n  CalendarDndProvider,\n  type CalendarEvent,\n  type CalendarView,\n  DayView,\n  EventDialog,\n  EventGap,\n  EventHeight,\n  MonthView,\n  WeekCellsHeight,\n  WeekView,\n} from \"@/registry/default/components/event-calendar\";\nimport { cn } from \"@/registry/default/lib/utils\";\nimport { Button } from \"@/registry/default/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuShortcut,\n  DropdownMenuTrigger,\n} from \"@/registry/default/ui/dropdown-menu\";\n\nexport interface EventCalendarProps {\n  events?: CalendarEvent[];\n  onEventAdd?: (event: CalendarEvent) => void;\n  onEventUpdate?: (event: CalendarEvent) => void;\n  onEventDelete?: (eventId: string) => void;\n  className?: string;\n  initialView?: CalendarView;\n}\n\nexport function EventCalendar({\n  events = [],\n  onEventAdd,\n  onEventUpdate,\n  onEventDelete,\n  className,\n  initialView = \"month\",\n}: EventCalendarProps) {\n  const [currentDate, setCurrentDate] = useState(new Date());\n  const [view, setView] = useState<CalendarView>(initialView);\n  const [isEventDialogOpen, setIsEventDialogOpen] = useState(false);\n  const [selectedEvent, setSelectedEvent] = useState<CalendarEvent | null>(\n    null,\n  );\n\n  // Add keyboard shortcuts for view switching\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Skip if user is typing in an input, textarea or contentEditable element\n      // or if the event dialog is open\n      if (\n        isEventDialogOpen ||\n        e.target instanceof HTMLInputElement ||\n        e.target instanceof HTMLTextAreaElement ||\n        (e.target instanceof HTMLElement && e.target.isContentEditable)\n      ) {\n        return;\n      }\n\n      switch (e.key.toLowerCase()) {\n        case \"m\":\n          setView(\"month\");\n          break;\n        case \"w\":\n          setView(\"week\");\n          break;\n        case \"d\":\n          setView(\"day\");\n          break;\n        case \"a\":\n          setView(\"agenda\");\n          break;\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n\n    return () => {\n      window.removeEventListener(\"keydown\", handleKeyDown);\n    };\n  }, [isEventDialogOpen]);\n\n  const handlePrevious = () => {\n    if (view === \"month\") {\n      setCurrentDate(subMonths(currentDate, 1));\n    } else if (view === \"week\") {\n      setCurrentDate(subWeeks(currentDate, 1));\n    } else if (view === \"day\") {\n      setCurrentDate(addDays(currentDate, -1));\n    } else if (view === \"agenda\") {\n      // For agenda view, go back 30 days (a full month)\n      setCurrentDate(addDays(currentDate, -AgendaDaysToShow));\n    }\n  };\n\n  const handleNext = () => {\n    if (view === \"month\") {\n      setCurrentDate(addMonths(currentDate, 1));\n    } else if (view === \"week\") {\n      setCurrentDate(addWeeks(currentDate, 1));\n    } else if (view === \"day\") {\n      setCurrentDate(addDays(currentDate, 1));\n    } else if (view === \"agenda\") {\n      // For agenda view, go forward 30 days (a full month)\n      setCurrentDate(addDays(currentDate, AgendaDaysToShow));\n    }\n  };\n\n  const handleToday = () => {\n    setCurrentDate(new Date());\n  };\n\n  const handleEventSelect = (event: CalendarEvent) => {\n    console.log(\"Event selected:\", event); // Debug log\n    setSelectedEvent(event);\n    setIsEventDialogOpen(true);\n  };\n\n  const handleEventCreate = (startTime: Date) => {\n    console.log(\"Creating new event at:\", startTime); // Debug log\n\n    // Snap to 15-minute intervals\n    const minutes = startTime.getMinutes();\n    const remainder = minutes % 15;\n    if (remainder !== 0) {\n      if (remainder < 7.5) {\n        // Round down to nearest 15 min\n        startTime.setMinutes(minutes - remainder);\n      } else {\n        // Round up to nearest 15 min\n        startTime.setMinutes(minutes + (15 - remainder));\n      }\n      startTime.setSeconds(0);\n      startTime.setMilliseconds(0);\n    }\n\n    const newEvent: CalendarEvent = {\n      allDay: false,\n      end: addHoursToDate(startTime, 1),\n      id: \"\",\n      start: startTime,\n      title: \"\",\n    };\n    setSelectedEvent(newEvent);\n    setIsEventDialogOpen(true);\n  };\n\n  const handleEventSave = (event: CalendarEvent) => {\n    if (event.id) {\n      onEventUpdate?.(event);\n      // Show toast notification when an event is updated\n      toast(`Event \"${event.title}\" updated`, {\n        description: format(new Date(event.start), \"MMM d, yyyy\"),\n        position: \"bottom-left\",\n      });\n    } else {\n      onEventAdd?.({\n        ...event,\n        id: Math.random().toString(36).substring(2, 11),\n      });\n      // Show toast notification when an event is added\n      toast(`Event \"${event.title}\" added`, {\n        description: format(new Date(event.start), \"MMM d, yyyy\"),\n        position: \"bottom-left\",\n      });\n    }\n    setIsEventDialogOpen(false);\n    setSelectedEvent(null);\n  };\n\n  const handleEventDelete = (eventId: string) => {\n    const deletedEvent = events.find((e) => e.id === eventId);\n    onEventDelete?.(eventId);\n    setIsEventDialogOpen(false);\n    setSelectedEvent(null);\n\n    // Show toast notification when an event is deleted\n    if (deletedEvent) {\n      toast(`Event \"${deletedEvent.title}\" deleted`, {\n        description: format(new Date(deletedEvent.start), \"MMM d, yyyy\"),\n        position: \"bottom-left\",\n      });\n    }\n  };\n\n  const handleEventUpdate = (updatedEvent: CalendarEvent) => {\n    onEventUpdate?.(updatedEvent);\n\n    // Show toast notification when an event is updated via drag and drop\n    toast(`Event \"${updatedEvent.title}\" moved`, {\n      description: format(new Date(updatedEvent.start), \"MMM d, yyyy\"),\n      position: \"bottom-left\",\n    });\n  };\n\n  const viewTitle = useMemo(() => {\n    if (view === \"month\") {\n      return format(currentDate, \"MMMM yyyy\");\n    }\n    if (view === \"week\") {\n      const start = startOfWeek(currentDate, { weekStartsOn: 0 });\n      const end = endOfWeek(currentDate, { weekStartsOn: 0 });\n      if (isSameMonth(start, end)) {\n        return format(start, \"MMMM yyyy\");\n      }\n      return `${format(start, \"MMM\")} - ${format(end, \"MMM yyyy\")}`;\n    }\n    if (view === \"day\") {\n      return (\n        <>\n          <span aria-hidden=\"true\" className=\"min-[480px]:hidden\">\n            {format(currentDate, \"MMM d, yyyy\")}\n          </span>\n          <span aria-hidden=\"true\" className=\"max-[479px]:hidden min-md:hidden\">\n            {format(currentDate, \"MMMM d, yyyy\")}\n          </span>\n          <span className=\"max-md:hidden\">\n            {format(currentDate, \"EEE MMMM d, yyyy\")}\n          </span>\n        </>\n      );\n    }\n    if (view === \"agenda\") {\n      // Show the month range for agenda view\n      const start = currentDate;\n      const end = addDays(currentDate, AgendaDaysToShow - 1);\n\n      if (isSameMonth(start, end)) {\n        return format(start, \"MMMM yyyy\");\n      }\n      return `${format(start, \"MMM\")} - ${format(end, \"MMM yyyy\")}`;\n    }\n    return format(currentDate, \"MMMM yyyy\");\n  }, [currentDate, view]);\n\n  return (\n    <div\n      className=\"flex flex-col rounded-lg border has-data-[slot=month-view]:flex-1\"\n      style={\n        {\n          \"--event-gap\": `${EventGap}px`,\n          \"--event-height\": `${EventHeight}px`,\n          \"--week-cells-height\": `${WeekCellsHeight}px`,\n        } as React.CSSProperties\n      }\n    >\n      <CalendarDndProvider onEventUpdate={handleEventUpdate}>\n        <div\n          className={cn(\n            \"flex items-center justify-between p-2 sm:p-4\",\n            className,\n          )}\n        >\n          <div className=\"flex items-center gap-1 sm:gap-4\">\n            <Button\n              className=\"max-[479px]:aspect-square max-[479px]:p-0!\"\n              onClick={handleToday}\n              variant=\"outline\"\n            >\n              <RiCalendarCheckLine\n                aria-hidden=\"true\"\n                className=\"min-[480px]:hidden\"\n                size={16}\n              />\n              <span className=\"max-[479px]:sr-only\">Today</span>\n            </Button>\n            <div className=\"flex items-center sm:gap-2\">\n              <Button\n                aria-label=\"Previous\"\n                onClick={handlePrevious}\n                size=\"icon\"\n                variant=\"ghost\"\n              >\n                <ChevronLeftIcon aria-hidden=\"true\" size={16} />\n              </Button>\n              <Button\n                aria-label=\"Next\"\n                onClick={handleNext}\n                size=\"icon\"\n                variant=\"ghost\"\n              >\n                <ChevronRightIcon aria-hidden=\"true\" size={16} />\n              </Button>\n            </div>\n            <h2 className=\"font-semibold text-sm sm:text-lg md:text-xl\">\n              {viewTitle}\n            </h2>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button className=\"gap-1.5 max-[479px]:h-8\" variant=\"outline\">\n                  <span>\n                    <span aria-hidden=\"true\" className=\"min-[480px]:hidden\">\n                      {view.charAt(0).toUpperCase()}\n                    </span>\n                    <span className=\"max-[479px]:sr-only\">\n                      {view.charAt(0).toUpperCase() + view.slice(1)}\n                    </span>\n                  </span>\n                  <ChevronDownIcon\n                    aria-hidden=\"true\"\n                    className=\"-me-1 opacity-60\"\n                    size={16}\n                  />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\" className=\"min-w-32\">\n                <DropdownMenuItem onClick={() => setView(\"month\")}>\n                  Month <DropdownMenuShortcut>M</DropdownMenuShortcut>\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setView(\"week\")}>\n                  Week <DropdownMenuShortcut>W</DropdownMenuShortcut>\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setView(\"day\")}>\n                  Day <DropdownMenuShortcut>D</DropdownMenuShortcut>\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setView(\"agenda\")}>\n                  Agenda <DropdownMenuShortcut>A</DropdownMenuShortcut>\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n            <Button\n              className=\"max-[479px]:aspect-square max-[479px]:p-0!\"\n              onClick={() => {\n                setSelectedEvent(null); // Ensure we're creating a new event\n                setIsEventDialogOpen(true);\n              }}\n              size=\"sm\"\n            >\n              <PlusIcon\n                aria-hidden=\"true\"\n                className=\"sm:-ms-1 opacity-60\"\n                size={16}\n              />\n              <span className=\"max-sm:sr-only\">New event</span>\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"flex flex-1 flex-col\">\n          {view === \"month\" && (\n            <MonthView\n              currentDate={currentDate}\n              events={events}\n              onEventCreate={handleEventCreate}\n              onEventSelect={handleEventSelect}\n            />\n          )}\n          {view === \"week\" && (\n            <WeekView\n              currentDate={currentDate}\n              events={events}\n              onEventCreate={handleEventCreate}\n              onEventSelect={handleEventSelect}\n            />\n          )}\n          {view === \"day\" && (\n            <DayView\n              currentDate={currentDate}\n              events={events}\n              onEventCreate={handleEventCreate}\n              onEventSelect={handleEventSelect}\n            />\n          )}\n          {view === \"agenda\" && (\n            <AgendaView\n              currentDate={currentDate}\n              events={events}\n              onEventSelect={handleEventSelect}\n            />\n          )}\n        </div>\n\n        <EventDialog\n          event={selectedEvent}\n          isOpen={isEventDialogOpen}\n          onClose={() => {\n            setIsEventDialogOpen(false);\n            setSelectedEvent(null);\n          }}\n          onDelete={handleEventDelete}\n          onSave={handleEventSave}\n        />\n      </CalendarDndProvider>\n    </div>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/components/event-calendar/index.ts",
      "content": "\"use client\";\n\n// Component exports\n\nexport { AgendaView } from \"./agenda-view\";\nexport { CalendarDndProvider, useCalendarDnd } from \"./calendar-dnd-context\";\n// Constants and utility exports\nexport * from \"./constants\";\nexport { DayView } from \"./day-view\";\nexport { DraggableEvent } from \"./draggable-event\";\nexport { DroppableCell } from \"./droppable-cell\";\nexport { EventCalendar } from \"./event-calendar\";\nexport { EventDialog } from \"./event-dialog\";\nexport { EventItem } from \"./event-item\";\nexport { EventsPopup } from \"./events-popup\";\n// Hook exports\nexport * from \"./hooks/use-current-time-indicator\";\nexport * from \"./hooks/use-event-visibility\";\nexport { MonthView } from \"./month-view\";\n// Type exports\nexport type { CalendarEvent, CalendarView, EventColor } from \"./types\";\nexport * from \"./utils\";\nexport { WeekView } from \"./week-view\";\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/components/event-calendar/month-view.tsx",
      "content": "\"use client\";\n\nimport {\n  addDays,\n  eachDayOfInterval,\n  endOfMonth,\n  endOfWeek,\n  format,\n  isSameDay,\n  isSameMonth,\n  isToday,\n  startOfMonth,\n  startOfWeek,\n} from \"date-fns\";\nimport type React from \"react\";\nimport { useEffect, useMemo, useState } from \"react\";\n\nimport {\n  type CalendarEvent,\n  DraggableEvent,\n  DroppableCell,\n  EventGap,\n  EventHeight,\n  EventItem,\n  getAllEventsForDay,\n  getEventsForDay,\n  getSpanningEventsForDay,\n  sortEvents,\n  useEventVisibility,\n} from \"@/registry/default/components/event-calendar\";\nimport { DefaultStartHour } from \"@/registry/default/components/event-calendar/constants\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/registry/default/ui/popover\";\n\ninterface MonthViewProps {\n  currentDate: Date;\n  events: CalendarEvent[];\n  onEventSelect: (event: CalendarEvent) => void;\n  onEventCreate: (startTime: Date) => void;\n}\n\nexport function MonthView({\n  currentDate,\n  events,\n  onEventSelect,\n  onEventCreate,\n}: MonthViewProps) {\n  const days = useMemo(() => {\n    const monthStart = startOfMonth(currentDate);\n    const monthEnd = endOfMonth(monthStart);\n    const calendarStart = startOfWeek(monthStart, { weekStartsOn: 0 });\n    const calendarEnd = endOfWeek(monthEnd, { weekStartsOn: 0 });\n\n    return eachDayOfInterval({ end: calendarEnd, start: calendarStart });\n  }, [currentDate]);\n\n  const weekdays = useMemo(() => {\n    return Array.from({ length: 7 }).map((_, i) => {\n      const date = addDays(startOfWeek(new Date()), i);\n      return format(date, \"EEE\");\n    });\n  }, []);\n\n  const weeks = useMemo(() => {\n    const result = [];\n    let week = [];\n\n    for (let i = 0; i < days.length; i++) {\n      week.push(days[i]);\n      if (week.length === 7 || i === days.length - 1) {\n        result.push(week);\n        week = [];\n      }\n    }\n\n    return result;\n  }, [days]);\n\n  const handleEventClick = (event: CalendarEvent, e: React.MouseEvent) => {\n    e.stopPropagation();\n    onEventSelect(event);\n  };\n\n  const [isMounted, setIsMounted] = useState(false);\n  const { contentRef, getVisibleEventCount } = useEventVisibility({\n    eventGap: EventGap,\n    eventHeight: EventHeight,\n  });\n\n  useEffect(() => {\n    setIsMounted(true);\n  }, []);\n\n  return (\n    <div className=\"contents\" data-slot=\"month-view\">\n      <div className=\"grid grid-cols-7 border-border/70 border-b\">\n        {weekdays.map((day) => (\n          <div\n            className=\"py-2 text-center text-muted-foreground/70 text-sm\"\n            key={day}\n          >\n            {day}\n          </div>\n        ))}\n      </div>\n      <div className=\"grid flex-1 auto-rows-fr\">\n        {weeks.map((week, weekIndex) => (\n          <div\n            className=\"grid grid-cols-7 [&:last-child>*]:border-b-0\"\n            key={`week-${week}`}\n          >\n            {week.map((day, dayIndex) => {\n              if (!day) return null; // Skip if day is undefined\n\n              const dayEvents = getEventsForDay(events, day);\n              const spanningEvents = getSpanningEventsForDay(events, day);\n              const isCurrentMonth = isSameMonth(day, currentDate);\n              const cellId = `month-cell-${day.toISOString()}`;\n              const allDayEvents = [...spanningEvents, ...dayEvents];\n              const allEvents = getAllEventsForDay(events, day);\n\n              const isReferenceCell = weekIndex === 0 && dayIndex === 0;\n              const visibleCount = isMounted\n                ? getVisibleEventCount(allDayEvents.length)\n                : undefined;\n              const hasMore =\n                visibleCount !== undefined &&\n                allDayEvents.length > visibleCount;\n              const remainingCount = hasMore\n                ? allDayEvents.length - visibleCount\n                : 0;\n\n              return (\n                <div\n                  className=\"group border-border/70 border-r border-b last:border-r-0 data-outside-cell:bg-muted/25 data-outside-cell:text-muted-foreground/70\"\n                  data-outside-cell={!isCurrentMonth || undefined}\n                  data-today={isToday(day) || undefined}\n                  key={day.toString()}\n                >\n                  <DroppableCell\n                    date={day}\n                    id={cellId}\n                    onClick={() => {\n                      const startTime = new Date(day);\n                      startTime.setHours(DefaultStartHour, 0, 0);\n                      onEventCreate(startTime);\n                    }}\n                  >\n                    <div className=\"mt-1 inline-flex size-6 items-center justify-center rounded-full text-sm group-data-today:bg-primary group-data-today:text-primary-foreground\">\n                      {format(day, \"d\")}\n                    </div>\n                    <div\n                      className=\"min-h-[calc((var(--event-height)+var(--event-gap))*2)] sm:min-h-[calc((var(--event-height)+var(--event-gap))*3)] lg:min-h-[calc((var(--event-height)+var(--event-gap))*4)]\"\n                      ref={isReferenceCell ? contentRef : null}\n                    >\n                      {sortEvents(allDayEvents).map((event, index) => {\n                        const eventStart = new Date(event.start);\n                        const eventEnd = new Date(event.end);\n                        const isFirstDay = isSameDay(day, eventStart);\n                        const isLastDay = isSameDay(day, eventEnd);\n\n                        const isHidden =\n                          isMounted && visibleCount && index >= visibleCount;\n\n                        if (!visibleCount) return null;\n\n                        if (!isFirstDay) {\n                          return (\n                            <div\n                              aria-hidden={isHidden ? \"true\" : undefined}\n                              className=\"aria-hidden:hidden\"\n                              key={`spanning-${event.id}-${day.toISOString().slice(0, 10)}`}\n                            >\n                              <EventItem\n                                event={event}\n                                isFirstDay={isFirstDay}\n                                isLastDay={isLastDay}\n                                onClick={(e) => handleEventClick(event, e)}\n                                view=\"month\"\n                              >\n                                <div aria-hidden={true} className=\"invisible\">\n                                  {!event.allDay && (\n                                    <span>\n                                      {format(\n                                        new Date(event.start),\n                                        \"h:mm\",\n                                      )}{\" \"}\n                                    </span>\n                                  )}\n                                  {event.title}\n                                </div>\n                              </EventItem>\n                            </div>\n                          );\n                        }\n\n                        return (\n                          <div\n                            aria-hidden={isHidden ? \"true\" : undefined}\n                            className=\"aria-hidden:hidden\"\n                            key={event.id}\n                          >\n                            <DraggableEvent\n                              event={event}\n                              isFirstDay={isFirstDay}\n                              isLastDay={isLastDay}\n                              onClick={(e) => handleEventClick(event, e)}\n                              view=\"month\"\n                            />\n                          </div>\n                        );\n                      })}\n\n                      {hasMore && (\n                        <Popover modal>\n                          <PopoverTrigger asChild>\n                            <button\n                              className=\"mt-(--event-gap) flex h-(--event-height) w-full select-none items-center overflow-hidden px-1 text-left text-[10px] text-muted-foreground outline-none backdrop-blur-md transition hover:bg-muted/50 hover:text-foreground focus-visible:border-ring focus-visible:ring-[3px] focus-visible:ring-ring/50 sm:px-2 sm:text-xs\"\n                              onClick={(e) => e.stopPropagation()}\n                              type=\"button\"\n                            >\n                              <span>\n                                + {remainingCount}{\" \"}\n                                <span className=\"max-sm:sr-only\">more</span>\n                              </span>\n                            </button>\n                          </PopoverTrigger>\n                          <PopoverContent\n                            align=\"center\"\n                            className=\"max-w-52 p-3\"\n                            style={\n                              {\n                                \"--event-height\": `${EventHeight}px`,\n                              } as Record<string, string>\n                            }\n                          >\n                            <div className=\"space-y-2\">\n                              <div className=\"font-medium text-sm\">\n                                {format(day, \"EEE d\")}\n                              </div>\n                              <div className=\"space-y-1\">\n                                {sortEvents(allEvents).map((event) => {\n                                  const eventStart = new Date(event.start);\n                                  const eventEnd = new Date(event.end);\n                                  const isFirstDay = isSameDay(day, eventStart);\n                                  const isLastDay = isSameDay(day, eventEnd);\n\n                                  return (\n                                    <EventItem\n                                      event={event}\n                                      isFirstDay={isFirstDay}\n                                      isLastDay={isLastDay}\n                                      key={event.id}\n                                      onClick={(e) =>\n                                        handleEventClick(event, e)\n                                      }\n                                      view=\"month\"\n                                    />\n                                  );\n                                })}\n                              </div>\n                            </div>\n                          </PopoverContent>\n                        </Popover>\n                      )}\n                    </div>\n                  </DroppableCell>\n                </div>\n              );\n            })}\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/components/event-calendar/types.ts",
      "content": "export type CalendarView = \"month\" | \"week\" | \"day\" | \"agenda\";\n\nexport interface CalendarEvent {\n  id: string;\n  title: string;\n  description?: string;\n  start: Date;\n  end: Date;\n  allDay?: boolean;\n  color?: EventColor;\n  location?: string;\n}\n\nexport type EventColor =\n  | \"sky\"\n  | \"amber\"\n  | \"violet\"\n  | \"rose\"\n  | \"emerald\"\n  | \"orange\";\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/components/event-calendar/utils.ts",
      "content": "import { isSameDay } from \"date-fns\";\n\nimport type {\n  CalendarEvent,\n  EventColor,\n} from \"@/registry/default/components/event-calendar\";\n\n/**\n * Get CSS classes for event colors\n */\nexport function getEventColorClasses(color?: EventColor | string): string {\n  const eventColor = color || \"sky\";\n\n  switch (eventColor) {\n    case \"sky\":\n      return \"bg-sky-200/50 hover:bg-sky-200/40 text-sky-950/80 dark:bg-sky-400/25 dark:hover:bg-sky-400/20 dark:text-sky-200 shadow-sky-700/8\";\n    case \"amber\":\n      return \"bg-amber-200/50 hover:bg-amber-200/40 text-amber-950/80 dark:bg-amber-400/25 dark:hover:bg-amber-400/20 dark:text-amber-200 shadow-amber-700/8\";\n    case \"violet\":\n      return \"bg-violet-200/50 hover:bg-violet-200/40 text-violet-950/80 dark:bg-violet-400/25 dark:hover:bg-violet-400/20 dark:text-violet-200 shadow-violet-700/8\";\n    case \"rose\":\n      return \"bg-rose-200/50 hover:bg-rose-200/40 text-rose-950/80 dark:bg-rose-400/25 dark:hover:bg-rose-400/20 dark:text-rose-200 shadow-rose-700/8\";\n    case \"emerald\":\n      return \"bg-emerald-200/50 hover:bg-emerald-200/40 text-emerald-950/80 dark:bg-emerald-400/25 dark:hover:bg-emerald-400/20 dark:text-emerald-200 shadow-emerald-700/8\";\n    case \"orange\":\n      return \"bg-orange-200/50 hover:bg-orange-200/40 text-orange-950/80 dark:bg-orange-400/25 dark:hover:bg-orange-400/20 dark:text-orange-200 shadow-orange-700/8\";\n    default:\n      return \"bg-sky-200/50 hover:bg-sky-200/40 text-sky-950/80 dark:bg-sky-400/25 dark:hover:bg-sky-400/20 dark:text-sky-200 shadow-sky-700/8\";\n  }\n}\n\n/**\n * Get CSS classes for border radius based on event position in multi-day events\n */\nexport function getBorderRadiusClasses(\n  isFirstDay: boolean,\n  isLastDay: boolean,\n): string {\n  if (isFirstDay && isLastDay) {\n    return \"rounded\"; // Both ends rounded\n  }\n  if (isFirstDay) {\n    return \"rounded-l rounded-r-none\"; // Only left end rounded\n  }\n  if (isLastDay) {\n    return \"rounded-r rounded-l-none\"; // Only right end rounded\n  }\n  return \"rounded-none\"; // No rounded corners\n}\n\n/**\n * Check if an event is a multi-day event\n */\nexport function isMultiDayEvent(event: CalendarEvent): boolean {\n  const eventStart = new Date(event.start);\n  const eventEnd = new Date(event.end);\n  return event.allDay || eventStart.getDate() !== eventEnd.getDate();\n}\n\n/**\n * Filter events for a specific day\n */\nexport function getEventsForDay(\n  events: CalendarEvent[],\n  day: Date,\n): CalendarEvent[] {\n  return events\n    .filter((event) => {\n      const eventStart = new Date(event.start);\n      return isSameDay(day, eventStart);\n    })\n    .sort((a, b) => new Date(a.start).getTime() - new Date(b.start).getTime());\n}\n\n/**\n * Sort events with multi-day events first, then by start time\n */\nexport function sortEvents(events: CalendarEvent[]): CalendarEvent[] {\n  return [...events].sort((a, b) => {\n    const aIsMultiDay = isMultiDayEvent(a);\n    const bIsMultiDay = isMultiDayEvent(b);\n\n    if (aIsMultiDay && !bIsMultiDay) return -1;\n    if (!aIsMultiDay && bIsMultiDay) return 1;\n\n    return new Date(a.start).getTime() - new Date(b.start).getTime();\n  });\n}\n\n/**\n * Get multi-day events that span across a specific day (but don't start on that day)\n */\nexport function getSpanningEventsForDay(\n  events: CalendarEvent[],\n  day: Date,\n): CalendarEvent[] {\n  return events.filter((event) => {\n    if (!isMultiDayEvent(event)) return false;\n\n    const eventStart = new Date(event.start);\n    const eventEnd = new Date(event.end);\n\n    // Only include if it's not the start day but is either the end day or a middle day\n    return (\n      !isSameDay(day, eventStart) &&\n      (isSameDay(day, eventEnd) || (day > eventStart && day < eventEnd))\n    );\n  });\n}\n\n/**\n * Get all events visible on a specific day (starting, ending, or spanning)\n */\nexport function getAllEventsForDay(\n  events: CalendarEvent[],\n  day: Date,\n): CalendarEvent[] {\n  return events.filter((event) => {\n    const eventStart = new Date(event.start);\n    const eventEnd = new Date(event.end);\n    return (\n      isSameDay(day, eventStart) ||\n      isSameDay(day, eventEnd) ||\n      (day > eventStart && day < eventEnd)\n    );\n  });\n}\n\n/**\n * Get all events for a day (for agenda view)\n */\nexport function getAgendaEventsForDay(\n  events: CalendarEvent[],\n  day: Date,\n): CalendarEvent[] {\n  return events\n    .filter((event) => {\n      const eventStart = new Date(event.start);\n      const eventEnd = new Date(event.end);\n      return (\n        isSameDay(day, eventStart) ||\n        isSameDay(day, eventEnd) ||\n        (day > eventStart && day < eventEnd)\n      );\n    })\n    .sort((a, b) => new Date(a.start).getTime() - new Date(b.start).getTime());\n}\n\n/**\n * Add hours to a date\n */\nexport function addHoursToDate(date: Date, hours: number): Date {\n  const result = new Date(date);\n  result.setHours(result.getHours() + hours);\n  return result;\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/components/event-calendar/week-view.tsx",
      "content": "\"use client\";\n\nimport {\n  addHours,\n  areIntervalsOverlapping,\n  differenceInMinutes,\n  eachDayOfInterval,\n  eachHourOfInterval,\n  endOfWeek,\n  format,\n  getHours,\n  getMinutes,\n  isBefore,\n  isSameDay,\n  isToday,\n  startOfDay,\n  startOfWeek,\n} from \"date-fns\";\nimport type React from \"react\";\nimport { useMemo } from \"react\";\n\nimport {\n  type CalendarEvent,\n  DraggableEvent,\n  DroppableCell,\n  EventItem,\n  isMultiDayEvent,\n  useCurrentTimeIndicator,\n  WeekCellsHeight,\n} from \"@/registry/default/components/event-calendar\";\nimport {\n  EndHour,\n  StartHour,\n} from \"@/registry/default/components/event-calendar/constants\";\nimport { cn } from \"@/registry/default/lib/utils\";\n\ninterface WeekViewProps {\n  currentDate: Date;\n  events: CalendarEvent[];\n  onEventSelect: (event: CalendarEvent) => void;\n  onEventCreate: (startTime: Date) => void;\n}\n\ninterface PositionedEvent {\n  event: CalendarEvent;\n  top: number;\n  height: number;\n  left: number;\n  width: number;\n  zIndex: number;\n}\n\nexport function WeekView({\n  currentDate,\n  events,\n  onEventSelect,\n  onEventCreate,\n}: WeekViewProps) {\n  const days = useMemo(() => {\n    const weekStart = startOfWeek(currentDate, { weekStartsOn: 0 });\n    const weekEnd = endOfWeek(currentDate, { weekStartsOn: 0 });\n    return eachDayOfInterval({ end: weekEnd, start: weekStart });\n  }, [currentDate]);\n\n  const weekStart = useMemo(\n    () => startOfWeek(currentDate, { weekStartsOn: 0 }),\n    [currentDate],\n  );\n\n  const hours = useMemo(() => {\n    const dayStart = startOfDay(currentDate);\n    return eachHourOfInterval({\n      end: addHours(dayStart, EndHour - 1),\n      start: addHours(dayStart, StartHour),\n    });\n  }, [currentDate]);\n\n  // Get all-day events and multi-day events for the week\n  const allDayEvents = useMemo(() => {\n    return events\n      .filter((event) => {\n        // Include explicitly marked all-day events or multi-day events\n        return event.allDay || isMultiDayEvent(event);\n      })\n      .filter((event) => {\n        const eventStart = new Date(event.start);\n        const eventEnd = new Date(event.end);\n        return days.some(\n          (day) =>\n            isSameDay(day, eventStart) ||\n            isSameDay(day, eventEnd) ||\n            (day > eventStart && day < eventEnd),\n        );\n      });\n  }, [events, days]);\n\n  // Process events for each day to calculate positions\n  const processedDayEvents = useMemo(() => {\n    const result = days.map((day) => {\n      // Get events for this day that are not all-day events or multi-day events\n      const dayEvents = events.filter((event) => {\n        // Skip all-day events and multi-day events\n        if (event.allDay || isMultiDayEvent(event)) return false;\n\n        const eventStart = new Date(event.start);\n        const eventEnd = new Date(event.end);\n\n        // Check if event is on this day\n        return (\n          isSameDay(day, eventStart) ||\n          isSameDay(day, eventEnd) ||\n          (eventStart < day && eventEnd > day)\n        );\n      });\n\n      // Sort events by start time and duration\n      const sortedEvents = [...dayEvents].sort((a, b) => {\n        const aStart = new Date(a.start);\n        const bStart = new Date(b.start);\n        const aEnd = new Date(a.end);\n        const bEnd = new Date(b.end);\n\n        // First sort by start time\n        if (aStart < bStart) return -1;\n        if (aStart > bStart) return 1;\n\n        // If start times are equal, sort by duration (longer events first)\n        const aDuration = differenceInMinutes(aEnd, aStart);\n        const bDuration = differenceInMinutes(bEnd, bStart);\n        return bDuration - aDuration;\n      });\n\n      // Calculate positions for each event\n      const positionedEvents: PositionedEvent[] = [];\n      const dayStart = startOfDay(day);\n\n      // Track columns for overlapping events\n      const columns: { event: CalendarEvent; end: Date }[][] = [];\n\n      for (const event of sortedEvents) {\n        const eventStart = new Date(event.start);\n        const eventEnd = new Date(event.end);\n\n        // Adjust start and end times if they're outside this day\n        const adjustedStart = isSameDay(day, eventStart)\n          ? eventStart\n          : dayStart;\n        const adjustedEnd = isSameDay(day, eventEnd)\n          ? eventEnd\n          : addHours(dayStart, 24);\n\n        // Calculate top position and height\n        const startHour =\n          getHours(adjustedStart) + getMinutes(adjustedStart) / 60;\n        const endHour = getHours(adjustedEnd) + getMinutes(adjustedEnd) / 60;\n\n        // Adjust the top calculation to account for the new start time\n        const top = (startHour - StartHour) * WeekCellsHeight;\n        const height = (endHour - startHour) * WeekCellsHeight;\n\n        // Find a column for this event\n        let columnIndex = 0;\n        let placed = false;\n\n        while (!placed) {\n          const col = columns[columnIndex] || [];\n          if (col.length === 0) {\n            columns[columnIndex] = col;\n            placed = true;\n          } else {\n            const overlaps = col.some((c) =>\n              areIntervalsOverlapping(\n                { end: adjustedEnd, start: adjustedStart },\n                {\n                  end: new Date(c.event.end),\n                  start: new Date(c.event.start),\n                },\n              ),\n            );\n\n            if (!overlaps) {\n              placed = true;\n            } else {\n              columnIndex++;\n            }\n          }\n        }\n\n        // Ensure column is initialized before pushing\n        const currentColumn = columns[columnIndex] || [];\n        columns[columnIndex] = currentColumn;\n        currentColumn.push({ end: adjustedEnd, event });\n\n        // Calculate width and left position based on number of columns\n        const width = columnIndex === 0 ? 1 : 0.9;\n        const left = columnIndex === 0 ? 0 : columnIndex * 0.1;\n\n        positionedEvents.push({\n          event,\n          height,\n          left,\n          top,\n          width,\n          zIndex: 10 + columnIndex, // Higher columns get higher z-index\n        });\n      }\n\n      return positionedEvents;\n    });\n\n    return result;\n  }, [days, events]);\n\n  const handleEventClick = (event: CalendarEvent, e: React.MouseEvent) => {\n    e.stopPropagation();\n    onEventSelect(event);\n  };\n\n  const showAllDaySection = allDayEvents.length > 0;\n  const { currentTimePosition, currentTimeVisible } = useCurrentTimeIndicator(\n    currentDate,\n    \"week\",\n  );\n\n  return (\n    <div className=\"flex h-full flex-col\" data-slot=\"week-view\">\n      <div className=\"sticky top-0 z-30 grid grid-cols-8 border-border/70 border-b bg-background/80 backdrop-blur-md\">\n        <div className=\"py-2 text-center text-muted-foreground/70 text-sm\">\n          <span className=\"max-[479px]:sr-only\">{format(new Date(), \"O\")}</span>\n        </div>\n        {days.map((day) => (\n          <div\n            className=\"py-2 text-center text-muted-foreground/70 text-sm data-today:font-medium data-today:text-foreground\"\n            data-today={isToday(day) || undefined}\n            key={day.toString()}\n          >\n            <span aria-hidden=\"true\" className=\"sm:hidden\">\n              {format(day, \"E\")[0]} {format(day, \"d\")}\n            </span>\n            <span className=\"max-sm:hidden\">{format(day, \"EEE dd\")}</span>\n          </div>\n        ))}\n      </div>\n\n      {showAllDaySection && (\n        <div className=\"border-border/70 border-b bg-muted/50\">\n          <div className=\"grid grid-cols-8\">\n            <div className=\"relative border-border/70 border-r\">\n              <span className=\"absolute bottom-0 left-0 h-6 w-16 max-w-full pe-2 text-right text-[10px] text-muted-foreground/70 sm:pe-4 sm:text-xs\">\n                All day\n              </span>\n            </div>\n            {days.map((day, dayIndex) => {\n              const dayAllDayEvents = allDayEvents.filter((event) => {\n                const eventStart = new Date(event.start);\n                const eventEnd = new Date(event.end);\n                return (\n                  isSameDay(day, eventStart) ||\n                  (day > eventStart && day < eventEnd) ||\n                  isSameDay(day, eventEnd)\n                );\n              });\n\n              return (\n                <div\n                  className=\"relative border-border/70 border-r p-1 last:border-r-0\"\n                  data-today={isToday(day) || undefined}\n                  key={day.toString()}\n                >\n                  {dayAllDayEvents.map((event) => {\n                    const eventStart = new Date(event.start);\n                    const eventEnd = new Date(event.end);\n                    const isFirstDay = isSameDay(day, eventStart);\n                    const isLastDay = isSameDay(day, eventEnd);\n\n                    // Check if this is the first day in the current week view\n                    const isFirstVisibleDay =\n                      dayIndex === 0 && isBefore(eventStart, weekStart);\n                    const shouldShowTitle = isFirstDay || isFirstVisibleDay;\n\n                    return (\n                      <EventItem\n                        event={event}\n                        isFirstDay={isFirstDay}\n                        isLastDay={isLastDay}\n                        key={`spanning-${event.id}`}\n                        onClick={(e) => handleEventClick(event, e)}\n                        view=\"month\"\n                      >\n                        {/* Show title if it's the first day of the event or the first visible day in the week */}\n                        <div\n                          aria-hidden={!shouldShowTitle}\n                          className={cn(\n                            \"truncate\",\n                            !shouldShowTitle && \"invisible\",\n                          )}\n                        >\n                          {event.title}\n                        </div>\n                      </EventItem>\n                    );\n                  })}\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      )}\n\n      <div className=\"grid flex-1 grid-cols-8 overflow-hidden\">\n        <div className=\"grid auto-cols-fr border-border/70 border-r\">\n          {hours.map((hour, index) => (\n            <div\n              className=\"relative min-h-[var(--week-cells-height)] border-border/70 border-b last:border-b-0\"\n              key={hour.toString()}\n            >\n              {index > 0 && (\n                <span className=\"-top-3 absolute left-0 flex h-6 w-16 max-w-full items-center justify-end bg-background pe-2 text-[10px] text-muted-foreground/70 sm:pe-4 sm:text-xs\">\n                  {format(hour, \"h a\")}\n                </span>\n              )}\n            </div>\n          ))}\n        </div>\n\n        {days.map((day, dayIndex) => (\n          <div\n            className=\"relative grid auto-cols-fr border-border/70 border-r last:border-r-0\"\n            data-today={isToday(day) || undefined}\n            key={day.toString()}\n          >\n            {/* Positioned events */}\n            {(processedDayEvents[dayIndex] ?? []).map((positionedEvent) => (\n              <div\n                className=\"absolute z-10 px-0.5\"\n                key={positionedEvent.event.id}\n                onClick={(e) => e.stopPropagation()}\n                style={{\n                  height: `${positionedEvent.height}px`,\n                  left: `${positionedEvent.left * 100}%`,\n                  top: `${positionedEvent.top}px`,\n                  width: `${positionedEvent.width * 100}%`,\n                  zIndex: positionedEvent.zIndex,\n                }}\n              >\n                <div className=\"size-full\">\n                  <DraggableEvent\n                    event={positionedEvent.event}\n                    height={positionedEvent.height}\n                    onClick={(e) => handleEventClick(positionedEvent.event, e)}\n                    showTime\n                    view=\"week\"\n                  />\n                </div>\n              </div>\n            ))}\n\n            {/* Current time indicator - only show for today's column */}\n            {currentTimeVisible && isToday(day) && (\n              <div\n                className=\"pointer-events-none absolute right-0 left-0 z-20\"\n                style={{ top: `${currentTimePosition}%` }}\n              >\n                <div className=\"relative flex items-center\">\n                  <div className=\"-left-1 absolute h-2 w-2 rounded-full bg-primary\" />\n                  <div className=\"h-[2px] w-full bg-primary\" />\n                </div>\n              </div>\n            )}\n            {hours.map((hour) => {\n              const hourValue = getHours(hour);\n              return (\n                <div\n                  className=\"relative min-h-[var(--week-cells-height)] border-border/70 border-b last:border-b-0\"\n                  key={hour.toString()}\n                >\n                  {/* Quarter-hour intervals */}\n                  {[0, 1, 2, 3].map((quarter) => {\n                    const quarterHourTime = hourValue + quarter * 0.25;\n                    return (\n                      <DroppableCell\n                        className={cn(\n                          \"absolute h-[calc(var(--week-cells-height)/4)] w-full\",\n                          quarter === 0 && \"top-0\",\n                          quarter === 1 &&\n                            \"top-[calc(var(--week-cells-height)/4)]\",\n                          quarter === 2 &&\n                            \"top-[calc(var(--week-cells-height)/4*2)]\",\n                          quarter === 3 &&\n                            \"top-[calc(var(--week-cells-height)/4*3)]\",\n                        )}\n                        date={day}\n                        id={`week-cell-${day.toISOString()}-${quarterHourTime}`}\n                        key={`${hour.toString()}-${quarter}`}\n                        onClick={() => {\n                          const startTime = new Date(day);\n                          startTime.setHours(hourValue);\n                          startTime.setMinutes(quarter * 15);\n                          onEventCreate(startTime);\n                        }}\n                        time={quarterHourTime}\n                      />\n                    );\n                  })}\n                </div>\n              );\n            })}\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/components/event-calendar/hooks/use-current-time-indicator.ts",
      "content": "\"use client\";\n\nimport { endOfWeek, isSameDay, isWithinInterval, startOfWeek } from \"date-fns\";\nimport { useEffect, useState } from \"react\";\n\nimport {\n  EndHour,\n  StartHour,\n} from \"@/registry/default/components/event-calendar/constants\";\n\nexport function useCurrentTimeIndicator(\n  currentDate: Date,\n  view: \"day\" | \"week\",\n) {\n  const [currentTimePosition, setCurrentTimePosition] = useState<number>(0);\n  const [currentTimeVisible, setCurrentTimeVisible] = useState<boolean>(false);\n\n  useEffect(() => {\n    const calculateTimePosition = () => {\n      const now = new Date();\n      const hours = now.getHours();\n      const minutes = now.getMinutes();\n      const totalMinutes = (hours - StartHour) * 60 + minutes;\n      const dayStartMinutes = 0; // 12am\n      const dayEndMinutes = (EndHour - StartHour) * 60; // 12am next day\n\n      // Calculate position as percentage of day\n      const position =\n        ((totalMinutes - dayStartMinutes) / (dayEndMinutes - dayStartMinutes)) *\n        100;\n\n      // Check if current day is in view based on the calendar view\n      let isCurrentTimeVisible = false;\n\n      if (view === \"day\") {\n        isCurrentTimeVisible = isSameDay(now, currentDate);\n      } else if (view === \"week\") {\n        const startOfWeekDate = startOfWeek(currentDate, { weekStartsOn: 0 });\n        const endOfWeekDate = endOfWeek(currentDate, { weekStartsOn: 0 });\n        isCurrentTimeVisible = isWithinInterval(now, {\n          end: endOfWeekDate,\n          start: startOfWeekDate,\n        });\n      }\n\n      setCurrentTimePosition(position);\n      setCurrentTimeVisible(isCurrentTimeVisible);\n    };\n\n    // Calculate immediately\n    calculateTimePosition();\n\n    // Update every minute\n    const interval = setInterval(calculateTimePosition, 60000);\n\n    return () => clearInterval(interval);\n  }, [currentDate, view]);\n\n  return { currentTimePosition, currentTimeVisible };\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/components/event-calendar/hooks/use-event-visibility.ts",
      "content": "\"use client\";\n\nimport { useLayoutEffect, useMemo, useRef, useState } from \"react\";\n\ninterface EventVisibilityOptions {\n  eventHeight: number;\n  eventGap: number;\n}\n\ninterface EventVisibilityResult {\n  contentRef: React.RefObject<HTMLDivElement>;\n  contentHeight: number | null;\n  getVisibleEventCount: (totalEvents: number) => number;\n}\n\n/**\n * Hook for calculating event visibility based on container height\n * Uses ResizeObserver for efficient updates\n */\nexport function useEventVisibility({\n  eventHeight,\n  eventGap,\n}: EventVisibilityOptions): EventVisibilityResult {\n  // Use the standard pattern for React refs\n  const contentRef = useRef<HTMLDivElement>(null);\n  const observerRef = useRef<ResizeObserver | null>(null);\n  const [contentHeight, setContentHeight] = useState<number | null>(null);\n\n  // Use layout effect for synchronous measurement before paint\n  useLayoutEffect(() => {\n    if (!contentRef.current) return;\n\n    // Function to update the content height\n    const updateHeight = () => {\n      if (contentRef.current) {\n        setContentHeight(contentRef.current.clientHeight);\n      }\n    };\n\n    // Initial measurement (synchronous)\n    updateHeight();\n\n    // Create observer only once and reuse it\n    if (!observerRef.current) {\n      observerRef.current = new ResizeObserver(() => {\n        // Just call updateHeight when resize is detected\n        updateHeight();\n      });\n    }\n\n    // Start observing the content container\n    observerRef.current.observe(contentRef.current);\n\n    // Clean up function\n    return () => {\n      if (observerRef.current) {\n        observerRef.current.disconnect();\n      }\n    };\n  }, []);\n\n  // Function to calculate visible events for a cell\n  const getVisibleEventCount = useMemo(() => {\n    return (totalEvents: number): number => {\n      if (!contentHeight) return totalEvents;\n\n      // Calculate how many events can fit in the container\n      const maxEvents = Math.floor(contentHeight / (eventHeight + eventGap));\n\n      // If all events fit, show them all\n      if (totalEvents <= maxEvents) {\n        return totalEvents;\n      }\n      // Otherwise, reserve space for \"more\" button by showing one less\n      return maxEvents > 0 ? maxEvents - 1 : 0;\n    };\n  }, [contentHeight, eventHeight, eventGap]);\n\n  // Use type assertion to satisfy TypeScript\n  return {\n    contentHeight,\n    contentRef,\n    getVisibleEventCount,\n  } as EventVisibilityResult;\n}\n",
      "type": "registry:component"
    }
  ],
  "meta": {
    "colSpan": 3,
    "tags": [
      "calendar"
    ]
  }
}